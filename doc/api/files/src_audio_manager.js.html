<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\audio\manager.js - lyria</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="lyria"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.2.12</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Checkpoints.html">Checkpoints</a></li>
            
                <li><a href="../classes/Connector.html">Connector</a></li>
            
                <li><a href="../classes/Director.html">Director</a></li>
            
                <li><a href="../classes/Engine.html">Engine</a></li>
            
                <li><a href="../classes/Game.html">Game</a></li>
            
                <li><a href="../classes/Layer.html">Layer</a></li>
            
                <li><a href="../classes/Log.html">Log</a></li>
            
                <li><a href="../classes/Loop.html">Loop</a></li>
            
                <li><a href="../classes/Preloader.html">Preloader</a></li>
            
                <li><a href="../classes/Scene.html">Scene</a></li>
            
                <li><a href="../classes/Viewport.html">Viewport</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Lyria.html">Lyria</a></li>
            
                <li><a href="../modules/lyria_gameobject.html">lyria/gameobject</a></li>
            
                <li><a href="../modules/lyria_language.html">lyria/language</a></li>
            
                <li><a href="../modules/lyria_layer.html">lyria/layer</a></li>
            
                <li><a href="../modules/lyria_log.html">lyria/log</a></li>
            
                <li><a href="../modules/lyria_loop.html">lyria/loop</a></li>
            
                <li><a href="../modules/lyria_preloader.html">lyria/preloader</a></li>
            
                <li><a href="../modules/Scene.html">Scene</a></li>
            
                <li><a href="../modules/Template.html">Template</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\audio\manager.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
define([&#x27;jquery&#x27;, &#x27;clamp&#x27;, &#x27;../log&#x27;, &#x27;../audio&#x27;, &#x27;mixedice&#x27;, &#x27;eventmap&#x27;], function($, clamp, Log, Audio, mixedice, EventMap) {


  var AudioManager = function() {

    mixedice([this, AudioManager.prototype], new EventMap());
    this.audioFiles = {};
  };

  var volume = 1;
  // default

  Object.defineProperty(AudioManager, &#x27;volume&#x27;, {
    get : function() {
      return volume;
    },
    set : function(value) {
      volume = clamp(value, 0, 1);
    }
  });

  /**
   *
   * @param {Object} options
   * @param {String} options.type [&#x27;music&#x27;, &#x27;sound&#x27;]
   * @param {String} options id
   * @param {Boolean} options loop
   * @param {Number} options volume
   * @param {Array} options paths paths to audio file with defined fallbacks
   *
   */
  AudioManager.prototype.add = function(options) {
    options = $.extend({
      &#x27;id&#x27; : &#x27;&#x27;,
      &#x27;type&#x27; : &#x27;sound&#x27;,
      &#x27;loop&#x27; : false,
      &#x27;volume&#x27; : 1.0,
      &#x27;paths&#x27; : []
    }, options);

    // set volume in relation to current max volume
    options.volume *= volume;

    if (options.id === &#x27;&#x27;) {
      Log.e(&#x27;AudioManager.add: No id was given for new audio object&#x27;);
      return;
    }

    this.audioFiles[options.id] = new Audio(options);
    this.trigger(&#x27;added&#x27;, options.id, this.audioFiles[options.id]);
    return this.audioFiles[options];
  };

  AudioManager.prototype.play = function(id, loop) {
    if (!this.audioFiles[id]) {
      Log.e(&#x27;AudioManager.play: No audio element found under id &#x27; + id);
      return;
    }
    
    $(&#x27;#&#x27; + id).off(&#x27;ended&#x27;);
    $(&#x27;#&#x27; + id).on(&#x27;ended&#x27;, {
      &#x27;audioFile&#x27; : this.audioFiles[id],
      &#x27;audioManager&#x27; : this,
      &#x27;id&#x27; : id
    }, function(event) {
      if (event.data.audioFile.attr(&#x27;loop&#x27;) &gt; 0 || event.data.audioFile.attr(&#x27;loop&#x27;) === -1) {
        event.data.audioFile.play();
        event.data.audioManager.trigger(&#x27;loopEnded&#x27;, event.data.id, event.data.audioFile);
      } else {
        event.data.audioManager.trigger(&#x27;ended&#x27;, event.data.id, event.data.audioFile);
      }
    });
    
    this.audioFiles[id].play(loop);
    this.trigger(&#x27;play&#x27;, id, this.audioFiles[id]);
  };

  AudioManager.prototype.pause = function(id) {
    if (!this.audioFiles[id]) {
      Log.e(&#x27;AudioManager.pause: No audio element found under id &#x27; + id);
      return;
    }
    this.audioFiles[id].pause();
    this.trigger(&#x27;paused&#x27;, id, this.audioFiles[id]);
  };

  AudioManager.prototype.stop = function(id) {
    if (!this.audioFiles[id]) {
      Log.e(&#x27;AudioManager.stop: No audio element found under id &#x27; + id);
      return;
    }
    this.audioFiles[id].stop();
    // ended event should be triggered automatically
  };

  AudioManager.prototype.volume = function(id, volume) {
    if (!this.audioFiles[id]) {
      Log.e(&#x27;AudioManager.volume: No audio element found under id &#x27; + id);
      return;
    }
    if (volume) {
      this.audioFiles[id].volume = clamp(volume, 0, 1);
    } else {
      return this.audioFiles[id].volume;
    }
  };
  return AudioManager;
});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
