/*! lyria - v0.2.3 - 11-11-2013 */
define("lyria/achievement",["clamp"],function(a){var b=function(){var b=function(b){if("string"==typeof b&&(b={name:b}),!b.name)throw new Error("An achievement needs to have a name.");this.name=b.name,this.id=b.id||"achievement-"+Date.now(),this.icon=b.icon||null,this.progress=b.progress||{min:0,max:1},this.unlocked=null==b.unlocked?!1:b.unlocked;var c=this.progress.min,d=this;Object.defineProperty(this.progress,"current",{get:function(){return c},set:function(b){c=a(b,d.progress.min,d.progress.max),c>=d.progress.max?d.unlocked=!0:d.unlocked===!0&&(d.unlocked=!1)},enumarable:!0,configurable:!0})};return b.prototype.reset=function(){this.progress.current=this.progress.min},b.prototype.unlock=function(){this.progress.current=this.progress.max},b.prototype.toJSON=function(){var a={};for(var b in this)Object.hasOwnProperty.call(this,b)||(a[b]=this[b]);return a},b.prototype.toString=function(){return JSON.stringify(this.toJSON())},b}();return b}),define("lyria/achievement/manager",["jquery","lyria/achievement","lyria/template/engine","lyria/template/list","lyria/localization"],function(a,b,c,d,e){var f={},g={localization:new e,add:function(a){a instanceof b&&(Object.hasOwnProperty.call(f,a.name)||(f[a.name]=a))},progressSeparator:"/",viewport:null,remove:function(a){Object.hasOwnProperty.call(f,a)&&delete f[a]},list:function(){},show:function(b){var e=f[b];if(null==e)throw new Error("Achievement "+b+" not found.");var h=g.localization.exists(e.name)?g.localization.t(e.name):e.name,i=g.localization.exists(e.name+"-description")?g.localization.t(e.name+"-description"):e.description,j=c.compile(d.achievement)({id:e.id,className:e.name,title:h,description:i,offscreen:!0,progressable:e.progress.max>0&&1!==e.progress.max,max:e.progress.max,current:e.progress.current,separator:g.progressSeparator});null==g.viewport?a("body").append(j):g.viewport.$element.append(j);var k=a("#"+e.id);k.css({opacity:0}),k.animate({opacity:1},600).delay(2e3).animate({opacity:0},600,function(){k.remove()})},toJSON:function(){var a,b,c={};for(a in f)b=f[a],c[a]=b.toJSON();return c},toString:function(){var a="";try{a=JSON.stringify(g.toJSON())}catch(b){throw new Error("Error while serializing achievements in AchievementManager: "+b)}return a},fromJSON:function(a){var b,c;for(b in a)c=a[b],g.add(c)},fromString:function(a){var b={};try{b=JSON.parse(a)}catch(c){throw new Error("Error while deserializing achivements in AchievementManager: "+c)}return g.fromJSON(b)}};return Object.defineProperty(g,"length",{get:function(){return Object.keys(f).length}}),Object.defineProperty(g,"unlockedCount",{get:function(){var b=0;return a.each(f,function(a,c){c.unlocked&&b++}),b}}),Object.defineProperty(g,"store",{get:function(){return f}}),g}),define("lyria/animation",["mixer","eventmap"],function(a,b){var c=function(){var c=function(d,e){this.$elem=d,this.frame.width=0||e.width,this.frame.height=0||e.height,this.frame.current=0,this.speed=1,this.sprite.width,this.sprite.height,this.sprite.image=new Image,a([this,c.prototype],new b),this.on("play",function(){}),this.on("pause",function(){}),this.on("reset",function(){}),this.on("stop",function(){})};return c}();return c}),define("lyria/audio",["root","jquery"],function(a,b){"use strict";var c=function(){var a=!1,c={},d=function(a,d){if(d&&"object"==typeof d){var e=document.createElement("audio");c[a]=d,b(e).attr("id",a).attr("preload","auto").append('<source src="'+d.filepath+'" />'),b("body").append(e),d.play&&this.play(a)}},e=function(a){a&&"string"==typeof fileObj&&(b("#"+a).remove(),window.log("Lyria.audio.removeAudioElement: "+a+" removed"))},f=function(d){c[d],b("#"+d).one("ended",{audioManager:this},function(a){window.chrome?b(this).load():b(this).currentTime=0;var c=b(this).attr("id"),d=a.data.audioManager.getSound(c);d.playAfter&&b("#"+d.playAfter).length>0&&a.data.audioManager.play(d.playAfter),d.loop&&a.data.audioManager.play(b(this).attr("id"))}),b("#"+d)[0].play(),a&&(b("#"+d)[0].volume=0)},g=function(a){return c[a]},h=function(a){b("#"+a).length>0?b("#"+a)[0].pause():window.log("error","Lyria.Audio.pause: cant finde element "+a+" to pause")},i=function(a){b("#"+a).length>0&&b("#"+a)[0]&&b("#"+a)[0].pause&&(b("#"+a)[0].pause(),b("#"+a)[0].currentTime=0)},j=function(a){return b("#"+a)[0].duration},k=function(a,c){return b("#"+a).length>0?"number"!=typeof c?b("#"+a)[0].volume:(b("#"+a)[0].volume=c,void 0):0},l=function(a,c){return"number"!=typeof c?b("#"+a)[0].currentTime:(b("#"+a)[0].currentTime=c,void 0)},m=function(a,b){switch(a){case"duration":case"length":return j();case"position":case"pos":if("undefined"==typeof b)return l();l(b);break;case"volume":if("undefined"==typeof b)return k();k(b)}},n=function(d){a=d;for(var e in c)c.hasOwnProperty(e)&&b("#"+e).length>0&&(b("#"+e)[0].volume=d?0:1)};return{addAudioElement:d,removeAudioElement:e,play:f,getSound:g,pause:h,stop:i,muteSounds:n,getLength:j,volume:k,pos:l,attr:m}};return c}),define("lyria/audio/manager",function(){var a={};return a}),define("lyria/checkpoints",["eventmap","mixer","deleteitem"],function(a,b,c){var d=function(){var d=function(){b([this,d.prototype],new a),this.startTime=performance.now(),this.checkpointList=[]};return d.prototype.pass=function(a){this.hasPassed(a)||(this.checkpointList.push(a),this.trigger("pass",a,performance.now()-this.startTime))},d.prototype.hasPassed=function(a){return-1!==this.checkpointList.indexOf(a)},d.prototype.reset=function(a){if(null==a)return this.checkpointList=[],this.trigger("reset"),void 0;var b=this.checkpointList.indexOf(a);-1!==b&&(this.checkpointList=c(this.checkpointList,b),this.trigger("reset",a))},d}();return d}),define("lyria/component",["mixer","eventmap","lyria/component/manager","lyria/log"],function(a,b,c,d){return function(){var e=function(c,d){a([this,e.prototype],new b),this.name=null!=c?c:this.constructor.name,this.type="Component",this.children={},d.apply(this,[this]),this.on("update",function(a){for(var b in children){var c=children[b];c&&c.trigger&&c.trigger("update",a)}})};return e.prototype.add=function(a){var b="anonymous-"+Date.now(),d=null;"string"==typeof a?(b=a,d=c.get(b)):(b=a.name||b,d=a),children[b]=d,this.trigger("add",b),d.trigger("added",this)},e.prototype.remove=function(a){null!=a&&(delete children[a],this.trigger("remove",a))},e.prototype.log=function(a){d.i(this.type+": "+a)},e}()}),define("lyria/component/manager",function(){var a={},b={};return b.add=function(b){var c=b.name||"anonymous-"+Date.now();a[c]=b},b.remove=function(a){null!=a&&delete b[a]},b.get=function(b){return a[b]},b}),define("lyria/debug",function(){return!0}),define("lyria/constants",function(){return{animSpeed:300}}),define("lyria/language",["detectr","lyria/events","lyria/mixin/language"],function(a,b,c){var d={defaultLanguage:"en"},e=a.Browser.language()||d.defaultLanguage;return c(d,e,b),d}),define("clamp",function(){var a=function(a,b,c){var d,e,f;return"object"==typeof a&&(d=a,b=d.min,c=d.max,a=d.value),Array.isArray(b)&&(e=b,b=e[0],c=e[1]),null==b&&(b=0),null==c&&(c=1),b>c&&(f=[c,b],b=f[0],c=f[1]),a>=b&&c>=a?a:a>c?c:b};return a}),define("deleteitem",function(){var a=function(a,b){var c,d,e,f,g,h,i;if(Array.isArray(a)){for(i=[],f=g=0,h=a.length;h>g;f=++g)c=a[f],f!==b&&i.push(c);return i}e={};for(d in a)d!==b&&(e[d]=a[d]);return e};return a}),define("fisheryates",["random"],function(a){return function(b){for(var c=b.length-1;c>0;c--){var d=a(c+1),e=b[c];b[c]=b[d],b[d]=e}return b}}),define("requestfullscreen",function(){return function(a){a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen&&a.webkitRequestFullScreen()}}),define("fullscreenelement",function(){return function(a){return a.fullscreenElement||a.mozFullScreenElement||a.webkitFullscreenElement}}),define("cancelfullscreen",function(){return function(a){a.cancelFullScreen?a.cancelFullScreen():a.mozCancelFullScreen?a.mozCancelFullScreen():a.webkitCancelFullScreen&&a.webkitCancelFullScreen()}}),define("fullscreen",["requestfullscreen","fullscreenelement","cancelfullscreen"],function(a,b,c){return{request:a,isFullscreen:b,cancel:c}}),define("jqueryify",["jquery"],function(a){return function(b){return b instanceof a?b:a(b)}}),define("nexttick",["requestanimationframe","cancelanimationframe"],function(a,b){return function(c){var d=a(function(){null!=c&&c(),b(d)})}}),define("options",["jquery"],function(a){return function(b,c){return a.extend(!0,b,c)}}),define("path",function(){var a="/",b={join:function(b){var c=function(){for(var a=[],c=0,d=b.length;d>c;c++)null!=b[c]&&""!==b[c]&&a.push(b[c]);return a}();return c.join(a)},resolve:function(c,d){Array.isArray(d)||(d=d.split(a));var e=c.split(a),f=[],g=e.concat(d),h=g.length-1;(".."===g[h]||"."===g[h])&&(g[h]="");for(var i=0,j=g.length;j>i;i++)if(null!=g[i]&&""!==g[i]){if("."===g[i])continue;if(".."===g[i+1]){g[i]="",g[i+1]="";continue}f.push(g[i])}return b.join(f)},dotToPath:function(a){return a?~a.indexOf(".")?b.join(a.split(".")):a:void 0}};return b}),define("random",function(){return function(a,b){return null==a&&(a=1),null==b&&(b=0),Math.floor(Math.random()*(a-b))+b}}),function(a){define("root",function(){return a})}(this),Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(a,b){var c=this[a],d=c,e=function(){return d},f=function(e){return c=d,d=b.call(this,a,c,e)};delete this[a]&&Object.defineProperty(this,a,{get:e,set:f,enumerable:!0,configurable:!0})}}),Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(a){var b=this[a];delete this[a],this[a]=b}}),define("lyria/events",["eventmap"],function(a){var b=b||new a;return b}),define("lyria/game",["eventmap","mixer","fullscreen","jquery","lyria/viewport","lyria/scene/director","lyria/preloader","lyria/loop","lyria/world","lyria/checkpoints"],function(a,b,c,d,e,f,g,h,i,j){"use strict";return function(){var k=function(h){var l=this;h=d.extend(h,{startLoop:!0}),b([this,k.prototype],new a),this.viewport=new e,this.viewport.parent=this,this.director=new f(this.viewport),this.director.parent=this,this.preloader=new g,this.preloader.parent=this,this.preloader.sceneDirector=this.director,this.paused=!1,this.mute=!1,this.world=new i,this.world.parent=this,this.checkpoints=new j,k.Loop.on("update",function(a){l.director.trigger("update",a)}),h.startLoop&&k.Loop.run(),this.on("pause",function(){l.paused=!0}),this.on("resume",function(){l.paused=!1}),this.on("fullscreen",function(){var a=l.viewport.$element[0];a&&(c.isFullscreen(a)?c.cancel(a):c.request(a))}),d(document).ready(function(){l.pause&&d(window).blur(l.pause.bind(l)),l.resume&&d(window).focus(l.resume.bind(l))})};return k.Loop=h,k}()}),define("lyria/gameobject",["mixer","eventmap","lyria/component","lyria/log"],function(a,b,c,d){"use strict";return function(){var e=function(){a([this,e.prototype],new b);var c=this;this.components={},this.className="gameobject",this.template={},this.template.source='<div id="{{id}}" class="{{className}}"></div>',this.on("update",function(a){_.isEmpty(c.components)||_.each(c.components,function(b,c){c.trigger("update",a)})})};return e.prototype.refresh=function(a){null==a&&this.template&&(a=this.template.data),this.template&&this.template.source&&(this.content=this.template.source(a)),this.trigger("refresh")},e.prototype.add=function(a){a instanceof c&&(this.components[a.name]=a)},e.prototype.execute=function(a){a.apply(this,this)},e.prototype.log=function(a){d.i("GameObject: "+a)},e}()}),define("lyria/input",function(){var a={};return a.key={},a.mouse={},a.key.down=function(){},a.key.up=function(){},a.mouse.down=function(){},a.mouse.up=function(){},a}),define("lyria/input/key",function(){var a={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,escape:27,left:37,up:38,right:39,down:40,insert:45,"delete":46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,semiColon:186,equalSign:187,comma:188,dash:189,period:190,forwardSlash:191,openBracket:219,backSlash:220,closeBraket:221,singleQuote:222};return a.define=function(b,c){a[b]=c},a}),define("lyria/layer",["mixer","lyria/gameobject"],function(a,b){"use strict";return function(){var c=function(){a(this.prototype,new b)};return c}()}),define("lyria/localization/group",["lyria/localization"],function(a){var b=function(){var b=function(b){for(var c in b){var d=b[c];this[c]=new a(d)}};return b}();return b}),define("lyria/localization",["lyria/language","lyria/template/string","lyria/mixin/language"],function(a,b,c){var d=function(){var d=function(b){null==b&&(b={}),this.data=b;var d=a.language;c(this,d,this)};return d.elements=function(a,c,d){return null==d&&(d="en"),function(e,f){return a&&0!==Object.keys(a).length?(a[c]&&0!==Object.keys(a[c]).length||(c=d),a[c]?null==a[c][e]?"[[Missing localization for "+e+"]]":"string"==typeof a[c][e]?b.process(a[c][e],f):{plural:function(d){return a[c][e][d]?b.process(a[c][e][d],f):b.process(a[c][e].n,f)}}:"[[No language definition found for "+c+"]]"):"[[No language data found]]"}},d.prototype.exists=function(a){return!!(this.data&&this.data[this.language]&&this.data[this.language][a])},d.prototype.t=function(){return d.elements(this.data,this.language).apply(this,arguments)},d}();return d}),define("lyria/log",["root"],function(a){"use strict";var b=function(){var b={};b.Connector=null,b.Plugins={},b.Plugins.Console={e:function(){return a.console&&a.console.error?a.console.error.apply(console,arguments):void 0},w:function(){return a.console&&a.console.warn?a.console.warn.apply(console,arguments):void 0},i:function(){return a.console&&a.console.info?a.console.info.apply(console,arguments):void 0},d:function(){return a.console&&a.console.log?a.console.log.apply(console,arguments):void 0},v:function(){return a.console&&a.console.log?a.console.log.apply(console,arguments):void 0}},b.Connector=b.Plugins.Console,b.logLevelMap={error:["e"],warn:["w","e"],info:["i","w","e"],debug:["d","i","w","e"],verbose:["v","d","i","w","e"]},b.logLevel="verbose";for(var c=["v","d","i","w","e"],d=0,e=c.length;e>d;d++)!function(a){b[a]=function(){b.logLevelMap[b.logLevel].indexOf(a)>=0&&b.Connector[a].apply(this,arguments)}}(c[d]);return b}();return a.log=a.out=b.i,b}),define("lyria/loop",["requestanimationframe","eventmap"],function(a,b){"use strict";var c=new b,d={};return function(){var b=!0,e=function(){var e;!function f(){a(f);var g=performance.now()||Date.now(),h=g-(e||g);if(e=g,b)for(var i=Object.keys(c.events),j=0,k=i.length;k>j;j++)!function(a){d[a]||c.trigger(a,h)}(i[j])}()},f=function(){b=!1},g=function(){c.clear(),d={}},h=function(a,b){c.on(a,b),d[a]=!1},i=function(a){c.off(a),null!=d[a]&&delete d[a]},j=function(a){d[a].paused=!0},k=function(a){return null==a?(b=!0,void 0):(d[a].paused=!1,void 0)};return{run:e,stop:f,clear:g,on:h,off:i,pause:j,resume:k}}()}),define("lyria/math",["random","clamp","fisheryates"],function(a,b,c){var d={random:a,clamp:b,fisherYates:c};return d}),define("lyria/mixin/language",function(){return function(a,b,c){Object.defineProperty(a,"language",{get:function(){return b},set:function(a){b=a,c.trigger("language:change",b)},configurable:!0,enumarable:!0})}}),define("lyria/prefab",["lyria/scene"],function(a){"use strict";return a}),define("lyria/prefab/manager",["jqueryify","jquery","root"],function(a,b,c){var d={};d.prefabs={},d.viewport=null,d.className="prefab";var e=function(e){return function(f,g){var h=f.name,i=f.parent;g=g||{},null==f.wrap&&(f.wrap=!0),f.wrap,null==i&&(i=(d.viewport?d.viewport.$element:void 0)||"body");var j=null,k=d.className+"-"+h+"-"+Date.now();if(g.id=k,!d.prefabs[h])throw new Error("No valid prefab called "+h+" found.");j=d.prefabs[h](g);var l=a(i);l&&(0===b("#"+j.name).length&&l[e](b(c.document.createElement("div")).attr("id",k).attr("class",d.className)),j.isAsync||j.trigger("added"))}};return d.append=function(){e("append").apply(this,arguments)},d.prepend=function(){e("prepend").apply(this,arguments)},d.insert=function(){e("html").apply(this,arguments)},d}),define("lyria/preloader",["root","mixer","jquery","lyria/resource","lyria/log","eventmap"],function(a,b,c,d,e,f){"use strict";var g=function(){var d=function(a){b([this,d.prototype],new f),this.assets=null!=a?a:{},this.maxAssets=0,this.assetsLoaded=0,this.percentLoaded=0,this.steps=[],this.taskList=[]};return d.prototype.task=function(a){taskList.add(a)},d.prototype.start=function(){if(null==this.assets)throw new Error("Assets should not be null. Pass at least an empty object.");this.trigger("start");var b=0;Object.keys(this.assets).length>0&&(b=this.assets.totalSize);var d=0;null==this.steps||0===this.steps.length;var f=null!=this.sceneDirector&&null!=this.loadingScene;f&&this.sceneDirector.show(this.loadingScene);var g=this,h=function(){var a=100;d!==b&&(a=d/b),g.trigger("progress",a),f&&g.sceneDirector.currentScene.trigger("progress",a,d,b),d>=b&&(f&&g.sceneDirector.currentScene.trigger("complete"),g.trigger("complete"))};Object.keys(this.assets).length>0?c.each(this.assets,function(b,f){if(null==f.files||!Array.isArray(f.files)||0===f.files.length)return!0;for(var g=0,i=f.files.length;i>g;g++)!function(b){if(0===b.type.indexOf("image")){var f=new a.Image;f.onload=function(){d+=b.size,h()},f.onerror=function(){e.e("Error while loading "+b.name)},f.src=b.name}else c.ajax({url:b.name,dataType:"text"}).always(function(){d+=b.size,h()}).error(function(a){e.e("Error while loading "+b.name+": "+a)})}(f.files[g])}):h()},d}();return g}),define("lyria/resource",["path"],function(a){var b={path:{assets:"assets",audio:"audio",data:"data",image:"images",scene:"scenes",video:"video",prefab:"prefabs"},name:function(c,d){if(c){var e=b.path.assets,f=b.path[d]?b.path[d]:d;return a.resolve(e,[a.dotToPath(f),c])}}};return b}),define("lyria/scene/director",["root","mixer","jquery","eventmap","lyria/scene","lyria/viewport"],function(a,b,c,d,e,f){"use strict";return function(){function g(a,c){b([this,g.prototype],new d),this.viewport=a instanceof f?a:new f(a,{parent:c}),this.sceneList={},this.className="scene",this.currentScene=null,this.defaultScene=null,this.on("render",function(){this.currentScene&&this.currentScene.trigger("render")}),this.on("update",function(a){this.currentScene&&this.currentScene.trigger("update",a)})}return g.prototype.add=function(b,d){"*"===b&&this.scenes&&(b=Object.keys(this.scenes));{if(!Array.isArray(b)){if(this.scenes&&Object.keys(this.scenes).length>0)b=this.scenes[b](d);else if(b instanceof e)d&&(b.data=d),this.scenes[b.name]=b;else{if("function"!=typeof b)throw new Error("No valid scene found.");var f=b(d);this.scenes[f.name]=f}return b.parent=this,null!=this.parent&&(b.game=this.parent),0===Object.keys(this.sceneList).length&&(this.defaultScene=b.name),this.sceneList[b.name]=b,this.viewport.$element&&0===c("#"+b.name).length&&this.viewport.$element.prepend(c(a.document.createElement("div")).attr("id",b.name).attr("class",this.className)),b.trigger("added"),this}for(var g=0,h=b.length;h>g;g++)this.add(b[g],d)}},g.prototype.show=function(a,b,d){if(a){c("."+this.className+":visible")&&c("."+this.className).hide(),this.currentScene&&(this.currentScene.transition&&this.currentScene.length?c("#"+this.currentScene).hide(this.currentScene.transition.length,function(){c("."+this.className).hide()}):c("."+this.className).hide(),this.currentScene.trigger("deactivate",b));var e=this;e.currentScene=this.sceneList[a],e.currentScene.transition&&e.currentScene.transition.length?c("#"+a).show(e.currentScene.transition.length):c("#"+a).show(),this.trigger("scene:change",a),e.currentScene.trigger("active",b),d&&d(a)}},g.prototype.refresh=function(a){var b=a?this.sceneList[a]:this.currentScene;b.refresh()},g}()}),define("lyria/scene",["jquery","mixer","nexttick","eventmap","lyria/gameobject","lyria/language","lyria/log","lyria/localization"],function(a,b,c,d,e,f,g,h){"use strict";var i=function(a,b,c){for(var d=b.split("."),e=0,f=d.length;f>e;e++)!function(b,d){a[b]=d?c:a[b]||{},a=a[b]}(d[e],e===f-1)},j=function(){var f=function(e,g,j,k){if(e){"function"==typeof g&&(k=j,j=g,g={}),b([this,f.prototype],new d);var l=this;this.name=e,this.data=k.data||{},this.localization=new h,this.defaultEvent="click",this.DOMEvents={},this.template={},this.template.source=null,this.template.helpers={},this.template.partials={},this.template.data={},this.children=this.children||{},this.children.gameObjects={},this.children.prefabs={},this.id=this.data.id||l.name,this.expose=function(b){b&&!a.isEmptyObject(b)&&(l.template.data=a.extend(!0,l.template.data,b))},Object.defineProperty(l,"$element",{get:function(){return a("#"+l.id)}}),l.on("synchronize",function(){l.refresh(),l.DOMEvents&&!a.isEmptyObject(l.DOMEvents)&&(l.DOMEvents.delegate="#"+l.id),l.on("update",function(b){a.each(l.children,function(c,d){a.isEmptyObject(d)||a.each(d,function(a,c){c.trigger("update",b)})})}),l.DOMEvents&&!a.isEmptyObject(l.DOMEvents)&&a.each(l.DOMEvents,function(b,c){"object"==typeof c&&"delegate"!==b&&a(l.DOMEvents.delegate).on(c,b,{scene:l})}),l.template.data&&!a.isEmptyObject(l.template.data)&&l.$element.find("[data-bind]").each(function(){var b=a(this),c=b.data("bind");l.template.data.watch(c,function(a,c,d){return c!==d&&b.html(d),d})})});var m=function(a){var b=function(a){return a?console.error("Error while executing scene "+l.name+": "+a):(l.trigger("synchronize"),void 0)},d=!1,e=l;e.async=function(){return d=!0,function(){c(function(){b()})}},l.hasOwnProperty("isAsync")||Object.defineProperty(l,"isAsync",{get:function(){return d}}),e.modules=a;try{var f=j.apply(e,[e,a]);d||b(null,f)}catch(g){b(g)}},n=Object.keys(f.requireAlways)||[];l.on("added",function(){require(n,function(){for(var a={},b=0,c=arguments.length;c>b;b++)!function(c){i(a,f.requireAlways[n[b]],c)}(arguments[b]);g=g||{};var d=Object.keys(g)||[];d.length?require(d,function(){for(var b=0,e=arguments.length;e>b;b++)!function(b){i(a,g[d[c]],b)}(arguments[c]);m(a)}):m(a)})})}};return f.prototype.add=function(b){var c=this;return b instanceof e?(this.children.gameObjects[b.name]=b,this.template.data.gameobject=function(){var b=[];return a.each(c.children.gameObjects,function(a,c){b.push(c)}),b}(),this.trigger("add"),!0):b instanceof e?(this.children.prefabs[b.name]=b,this.template.data.gameobject=function(){var b=[];return a.each(c.children.gameObjects,function(a,c){b.push(c)}),b}(),this.trigger("add"),!0):!1},f.prototype.refresh=function(a){null==a&&this.template&&(a=this.template.data),this.template.helpers.translate=h.elements(this.localization.data,this.localization.language),this.template&&this.template.source&&(this.content=this.template.source(a,{partials:this.template.partials,helpers:this.template.helpers})),this.$element.length>0&&this.$element.html(this.content),this.trigger("refresh")},f.prototype.bindEvent=function(a,b,c){if(null!=a)if("function"==typeof b)this.DOMEvents[a][this.defaultEvent]=c;else{if("string"!=typeof b)throw new Error("If you meant to bind more than one event, please use Scene#bindEvents");this.DOMEvents[a][b]=c}},f.prototype.bindEvents=function(a){if(null!=a)for(var b in a)Object.hasOwnProperty.call(a,b)&&(this.DOMEvents[b]=a[b])},f.prototype.unbindEvent=function(a,b){null!=a&&(null==b?delete this.DOMEvents[a]:delete this.DOMEvents[a][b])},f.prototype.unbindEvents=function(a){if(null==a||"*"===a)return this.DOMEvents={},void 0;if(Array.isArray(a))for(var b=0,c=a.length;c>b;b++)this.DOMEvents[a[b]]&&delete this.DOMEvents[a[b]];else for(var d in a)if(Object.hasOwnProperty.call(a,d)){var e=a[d];if(Array.isArray(e))for(var f=0,g=e.length;g>f;f++)delete this.DOMEvents[d][e[f]];else delete this.DOMEvents[d][e]}},f.prototype.t=function(){return this.localization&&this.localization.t?this.localization.t.apply(this.localization,arguments):void 0},f.prototype.log=function(a){g.i("Scene "+this.name+": "+a)},f.requireAlways={jquery:"$","lyria/achievement":"Lyria.Achievement","lyria/achievement/manager":"Lyria.AchievementManager","lyria/animation":"Lyria.Animation","lyria/audio":"Lyria.Audio","lyria/checkpoints":"Lyria.Checkpoints","lyria/component":"Lyria.Component","lyria/events":"Lyria.Events","lyria/gameobject":"Lyria.GameObject","lyria/log":"Lyria.Log","lyria/loop":"Lyria.Loop","lyria/prefab/manager":"Lyria.PrefabManager","lyria/resource":"Lyria.Resource","lyria/tween":"Lyria.Tween"},f}();return j}),define("lyria/serialize",["jquery"],function(a){var b=function(b){return"object"!=typeof b||b instanceof a?void 0:JSON.stringify(b,function(b,c){return c instanceof a?null:("function"==typeof c&&(c=c.toString()),c)})};return b}),define("lyria/template/connector",["lyria/template/methods"],function(a){var b=function(){};return function(){for(var c=function(a){if("object"==typeof a){var b,c;for(b in a)c=a[b],"function"==typeof c&&(this[b]=c)}},d=0,e=a.length;e>d;d++)!function(a){c.prototype[a]=b}(a[d]);return c}()}),define("lyria/template/engine",["root","lyria/template/connector","lyria/template/methods"],function(a,b,c){var d=function(){},e=function(a){if(a instanceof b)for(var f=0,g=c.length;g>f;f++)!function(b){e[b]=null!=a[b]&&"function"==typeof a[b]?a[b]:d}(c[f])};if(a.Handlebars){var f=new b({compile:function(){return a.Handlebars.template.apply(this,arguments)},globalHelpers:function(){return a.Handlebars.helpers}});e(f)}return e}),define("lyria/template/methods",function(){return["compile"]}),define("lyria/template/string",function(){var a={key:{start:"{{",end:"}}"},process:function(b,c){if(null!=b){if("object"==typeof c)if(Array.isArray(c))for(var d=0,e=c.length;e>d;d++)b=b.replace(new RegExp(a.key.start+d+a.key.end),c[d]);else for(var f=Object.keys(c),g=0,h=f.length;h>g;g++)!function(c){b=b.replace(new RegExp(a.key.start+f[g]+a.key.end),c)}(c[f[g]]);return b}}};return a}),define("lyria/tween",["eventmap","mixer","options","jqueryify"],function(a,b,c,d){var e=function(){var e=function(f){f=c(f,{elem:null,effects:[{property:null,target:null,easing:e.defaults.easing,duration:e.defaults.duration,delay:e.defaults.delay}]}),this.$elem=d(f.elem),this.effects=f.effects,this.hwAccelerated=!0,b([this,e.prototype],new a);var g=this;this.on("start",function(){if(!g.$elem){for(var a=[],b={},c=0,d=g.effects.length;d>c;c++)!function(c){null!=c.property&&null!=c.target&&(c.duration=c.duration||e.defaults.duration,c.easing=c.easing||e.defaults.easing,c.delay=c.delay||e.defaults.delay,a.push([c.property,c.duration,c.easing,c.delay].join(" ")),b[c.property]=c.target)}(g.effects[c]);b.transition=a.join(", "),g.$elem.css(b),$(document).one("transitionend",function(a){console.log(a.target)})}})};return e.defaults={easing:"linear",duration:"300ms",delay:"0ms"},e}();return e}),define("lyria/video",function(){"use strict";var a=function(){var a=function(){};return a.prototype.loadFromFile=function(){},a.prototype.play=function(){},a.prototype.pause=function(){},a.prototype.stop=function(){},a}();return a}),define("lyria/viewport",["root","jquery","mixer","eventmap"],function(a,b,c,d){"use strict";return function(){function e(f,g){var h={parent:null,trigger:{element:window,event:"resize"},scaleMode:"scaleToFit"};if(g=b.extend(g,h),c([this,e.prototype],new d),this.scale={},this.scale.mode=g.scaleMode,this.scale.x=1,this.scale.y=1,null==f&&(f="viewport"),Object.defineProperty(this,"$element",{get:function(){return b("#"+f)}}),0===this.$element.length){var i=b(a.document.createElement("div")).attr("id",f).attr("class","viewport");g.parent?b(g.parent).prepend(i):b("body").prepend(i)}Object.defineProperty(this,"width",{get:function(){return this.$element.outerWidth()}}),Object.defineProperty(this,"height",{get:function(){return this.$element.outerHeight()}});var j=this;this.on("scale",function(){var a=function(a,b){null==b&&(b=a);var c="scale("+a+", "+b+")";j.$element.css("transform",c),j.scale.x=a,j.scale.y=b},c=function(c){var d=0;return j.height>b(g.trigger.element).innerHeight()?(d=b(g.trigger.element).innerHeight()/j.height,c?d:(a(d),d)):1},d=function(c){var d=0;return j.width>b(g.trigger.element).innerWidth()?(d=b(g.trigger.element).innerWidth()/j.width,c?d:(a(d),d)):1};switch(j.scale.mode){case"stretch":break;case"cover":break;case"scaleToFit":var e=1,f=1;b(g.trigger.element).innerHeight()<j.height&&(f=c(!0)),b(g.trigger.element).innerWidth()<j.width&&(e=d(!0)),a(Math.min(e,f));break;case"scaleHeightToFit":c();break;case"scaleWidthToFit":d()}}),b(g.trigger.element).on(g.trigger.event,j.trigger.bind(j,"scale")),j.trigger("scale")}return e}()}),define("lyria/world",["mixer","eventmap"],function(a,b){return function(){var c=function(){a([this,c.prototype],new b)};return c}()}),define("lyria/template/list",{"achievement-list":function(a,b,c,d,e){function f(a,b){var e,f="";return f+="\r\n    ",e=i.invokePartial(d.achievement,"achievement",a,c,d,b),(e||0===e)&&(f+=e),f+="\r\n  "}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),d=this.merge(d,a.partials),e=e||{};var g,h="",i=this;return h+='<div class="achievement-list">\r\n  ',g=c.each.call(b,b&&b.achievement,{hash:{},inverse:i.noop,fn:i.program(1,f,e),data:e}),(g||0===g)&&(h+=g),h+="\r\n</div>"},achievement:function(a,b,c,d,e){function f(){return"offscreen"}function g(a,b){var d,e="";return e+='\r\n  <div class="progress-status">\r\n    <span class="current">',(d=c.current)?d=d.call(a,{hash:{},data:b}):(d=a&&a.current,d=typeof d===j?d.call(a,{hash:{},data:b}):d),e+=k(d)+'</span>\r\n    <span class="separator">',(d=c.separator)?d=d.call(a,{hash:{},data:b}):(d=a&&a.separator,d=typeof d===j?d.call(a,{hash:{},data:b}):d),e+=k(d)+'</span>\r\n    <span class="max">',(d=c.max)?d=d.call(a,{hash:{},data:b}):(d=a&&a.max,d=typeof d===j?d.call(a,{hash:{},data:b}):d),e+=k(d)+"</span>\r\n  </div>\r\n  "}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i="",j="function",k=this.escapeExpression,l=this;return i+='<div id="',(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b&&b.id,h=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(h)+'" class="achievement ',h=c["if"].call(b,b&&b.offscreen,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(h||0===h)&&(i+=h),i+='">\r\n  <div class="title">',(h=c.title)?h=h.call(b,{hash:{},data:e}):(h=b&&b.title,h=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(h)+'</div>\r\n  <div class="icon ',(h=c.className)?h=h.call(b,{hash:{},data:e}):(h=b&&b.className,h=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(h)+'"></div>\r\n  <div class="description">',(h=c.description)?h=h.call(b,{hash:{},data:e}):(h=b&&b.description,h=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(h)+"</div>\r\n  ",h=c["if"].call(b,b&&b.progressable,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(h||0===h)&&(i+=h),i+="\r\n</div>"},scene:function(a,b,c,d,e){function f(a,b){var d,e="";return e+='\r\n  <canvas id="',(d=c.name)?d=d.call(a,{hash:{},data:b}):(d=a&&a.name,d=typeof d===i?d.call(a,{hash:{},data:b}):d),e+=j(d)+'" class="',(d=c.type)?d=d.call(a,{hash:{},data:b}):(d=a&&a.type,d=typeof d===i?d.call(a,{hash:{},data:b}):d),e+=j(d)+'"></canvas>\r\n'}function g(a,b){var d,e="";return e+='\r\n  <div id="',(d=c.name)?d=d.call(a,{hash:{},data:b}):(d=a&&a.name,d=typeof d===i?d.call(a,{hash:{},data:b}):d),e+=j(d)+'" class="',(d=c.type)?d=d.call(a,{hash:{},data:b}):(d=a&&a.type,d=typeof d===i?d.call(a,{hash:{},data:b}):d),e+=j(d)+'"></div>\r\n'}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i="function",j=this.escapeExpression,k=this;return h=c["if"].call(b,b&&b.canvas,{hash:{},inverse:k.program(3,g,e),fn:k.program(1,f,e),data:e}),h||0===h?h:""}});