/*! lyria - v0.3.0-alpha2 - 19-01-2015 */
define("lyria/achievement",["clamp"],function(a){"use strict";var b=function(){var b=function(b){if(null==b)throw new Error("An achievement constructor needs to be called with a parameter");if("string"==typeof b&&(b={name:b}),!b.name)throw new Error("An achievement needs to have a name.");this.name=b.name,this.id=b.id||"achievement-"+Date.now(),this.icon=b.icon||null,this.progress=b.progress||{min:0,max:1},this.unlocked=null==b.unlocked?!1:b.unlocked;var c=this.progress.min,d=this;Object.defineProperty(this.progress,"current",{get:function(){return c},set:function(b){c=a(b,d.progress.min,d.progress.max),c>=d.progress.max?d.unlocked=!0:d.unlocked===!0&&(d.unlocked=!1)},enumarable:!0,configurable:!0})};return b.prototype.reset=function(){this.progress.current=this.progress.min},b.prototype.unlock=function(){this.progress.current=this.progress.max},b.prototype.toJSON=function(){var a={};for(var b in this)Object.hasOwnProperty.call(this,b)||(a[b]=this[b]);return a},b.prototype.toString=function(){return JSON.stringify(this.toJSON())},b}();return b}),define("lyria/achievement/manager",["require"],function(a){"use strict";var b=a("jquery"),c=a("../achievement"),d=a("../template/engine"),e=a("../template/list"),f=a("../localization"),g={},h={localization:new f,add:function(a){a instanceof c&&(Object.hasOwnProperty.call(g,a.name)||(g[a.name]=a))},progressSeparator:"/",viewport:null,remove:function(a){Object.hasOwnProperty.call(g,a)&&delete g[a]},list:function(){},show:function(a){var c=g[a];if(null==c)throw new Error("Achievement "+a+" not found.");var f=h.localization.exists(c.name)?h.localization.t(c.name):c.name,i=h.localization.exists(c.name+"-description")?h.localization.t(c.name+"-description"):c.description,j=d.compile(e.achievement)({id:c.id,className:c.name,title:f,description:i,offscreen:!0,progressable:c.progress.max>0&&1!==c.progress.max,max:c.progress.max,current:c.progress.current,separator:h.progressSeparator});null==h.viewport?b("body").append(j):h.viewport.$element.append(j);var k=b("#"+c.id);k.css({opacity:0}),k.animate({opacity:1},600).delay(2e3).animate({opacity:0},600,function(){k.remove()})},toJSON:function(){var a,b,c={};for(a in g)b=g[a],c[a]=b.toJSON();return c},toString:function(){var a="";try{a=JSON.stringify(h.toJSON())}catch(b){throw new Error("Error while serializing achievements in AchievementManager: "+b)}return a},fromJSON:function(a){var b,c;for(b in a)c=a[b],h.add(c)},fromString:function(a){var b={};try{b=JSON.parse(a)}catch(c){throw new Error("Error while deserializing achivements in AchievementManager: "+c)}return h.fromJSON(b)}};return Object.defineProperty(h,"length",{get:function(){return Object.keys(g).length}}),Object.defineProperty(h,"unlockedCount",{get:function(){var a=0;return b.each(g,function(b,c){c.unlocked&&a++}),a}}),Object.defineProperty(h,"store",{get:function(){return g}}),h}),define("lyria/animation",["jquery","mixedice","eventmap"],function(a,b,c){"use strict";var d=function(){var d=function(e,f){this.$elem=e;var g={frame:{width:0,height:0,current:0},speed:1};f=a.extend(!0,g,f),this.frame={},this.frame.width=f.frame.width,this.frame.height=f.frame.height,this.frame.current=f.frame.current,this.speed=f.speed,this.sprite={},this.sprite.width,this.sprite.height,this.sprite.image=new Image,b([this,d.prototype],new c),this.on("play",function(){}),this.on("pause",function(){}),this.on("reset",function(){}),this.on("stop",function(){})};return d}();return d}),define("lyria/audio",["root","jquery"],function(a,b){"use strict";var c={mp3:"audio/mpeg",wav:"audio/wav",ogg:"audio/ogg"},d=function(a){a=b.extend({id:"",volume:1,loop:1,paths:[]},a),this.options=a,this.audio=new window.Audio;for(var d=0;d<a.paths.length;d++){var e=a.paths[d].split(".").pop();if(c[e]&&this.audio.canPlayType(c[e])){this.audio.type=c[e],this.audio.src=a.paths[d];break}}this.audio.volume=a.volume,this.audio.id="lyria-audio-"+a.id,this.audio.preload="none",b("body").append(this.audio)};return d.prototype.play=function(a){this.audio.currentTime&&(this.audio.currentTime=0),detectr.is("browser-chrome")&&this.audio.load(),null!=a&&(this.options.loop=a),this.options.loop&&this.options.loop>0&&this.options.loop--,this.audio.play()},d.prototype.pause=function(){this.audio.pause()},d.prototype.stop=function(){this.options.loop=1,this.audio.pause(),this.audio.currentTime=0},d.prototype.attr=function(a,b){switch(a){case"duration":case"length":return this.audio.duration;case"position":case"pos":if("undefined"==typeof b)return this.audio.currentTime;this.audio.currentTime=b;break;case"loop":if("undefined"==typeof b)return this.options.loop;this.options.loop=b;break;case"volume":case"vol":if("undefined"==typeof b)return this.audio.volume;this.audio.volume=b}},d}),define("lyria/audio/manager",["jquery","clamp","../log","../audio","mixedice","eventmap"],function(a,b,c,d,e,f){"use strict";var g=function(){e([this,g.prototype],new f),this.audioFiles={}},h=1;return Object.defineProperty(g,"volume",{get:function(){return h},set:function(a){h=b(a,0,1)}}),g.prototype.add=function(b){return b=a.extend({id:"",type:"sound",loop:!1,volume:1,paths:[]},b),b.volume*=h,""===b.id?void c.e("AudioManager.add: No id was given for new audio object"):(this.audioFiles[b.id]=new d(b),this.trigger("added",b.id,this.audioFiles[b.id]),this.audioFiles[b])},g.prototype.play=function(b,d){return this.audioFiles[b]?(a("#lyria-audio-"+b).off("ended"),a("#lyria-audio-"+b).on("ended",{audioFile:this.audioFiles[b],audioManager:this,id:b},function(a){a.data.audioFile.attr("loop")>0||-1===a.data.audioFile.attr("loop")?(a.data.audioFile.play(),a.data.audioManager.trigger("loopEnded",a.data.id,a.data.audioFile)):a.data.audioManager.trigger("ended",a.data.id,a.data.audioFile)}),this.audioFiles[b].play(d),void this.trigger("play",b,this.audioFiles[b])):void c.e("AudioManager.play: No audio element found under id "+b)},g.prototype.pause=function(a){return this.audioFiles[a]?(this.audioFiles[a].pause(),void this.trigger("paused",a,this.audioFiles[a])):void c.e("AudioManager.pause: No audio element found under id "+a)},g.prototype.stop=function(a){return this.audioFiles[a]?void this.audioFiles[a].stop():void c.e("AudioManager.stop: No audio element found under id "+a)},g.prototype.volume=function(a,d){return this.audioFiles[a]?d?void(this.audioFiles[a].volume=b(d,0,1)):this.audioFiles[a].volume:void c.e("AudioManager.volume: No audio element found under id "+a)},g}),define("lyria/checkpoints",["eventmap","mixedice","deleteitem","performance"],function(a,b,c,d){"use strict";return function(){var e=function(){b([this,e.prototype],new a),this.startTime=d.now(),this.checkpointList=[]};return e.prototype.pass=function(a){this.hasPassed(a)||(this.checkpointList.push(a),this.trigger("pass",a,d.now()-this.startTime))},e.prototype.hasPassed=function(a){return-1!==this.checkpointList.indexOf(a)},e.prototype.reset=function(a){if(0!==this.checkpointList.length){if(null==a){var b=this.checkpointList;return this.checkpointList=[],void this.trigger("reset",b)}var d=this.checkpointList.indexOf(a);-1!==d&&(this.checkpointList=c(this.checkpointList,d),this.trigger("reset",a))}},e}()}),define("lyria/component",["mixedice","eventmap","./component/manager","./log"],function(a,b,c,d){"use strict";return function(){var e=function(c,d){a([this,e.prototype],new b),this.name=null!=c?c:this.constructor.name,this.type="Component",this.children={},d&&d.apply(this,[this]),this.on("update",function(a){for(var b in this.children){var c=this.children[b];c&&c.trigger&&c.trigger("update",a)}})};return e.prototype.add=function(a){var b="anonymous-"+Date.now(),d=null;"string"==typeof a?(b=a,d=c.get(b)):(b=a.name||b,d=a),this.children[b]=d,this.trigger("add",b),d.trigger("added",this)},e.prototype.remove=function(a){null!=a&&(delete this.children[a],this.trigger("remove",a))},e.prototype.log=function(a){d.i(this.type===this.name?this.type+": "+a:"["+this.type+"] "+this.name+": "+a)},e}()}),define("lyria/component/manager",function(){"use strict";var a={},b={};return b.add=function(b){var c=b.name||"anonymous-"+Date.now();a[c]=b},b.remove=function(a){null!=a&&delete b[a]},b.get=function(b){return a[b]},b}),define("lyria/constants",function(){"use strict";return{animSpeed:300}}),define("clamp",function(){"use strict";var a=function(a,b,c){var d,e,f;return"object"==typeof a&&(d=a,b=d.min,c=d.max,a=d.value),Array.isArray(b)&&(e=b,b=e[0],c=e[1]),null==b&&(b=0),null==c&&(c=1),b>c&&(f=[c,b],b=f[0],c=f[1]),a>=b&&c>=a?a:a>c?c:b};return a}),define("deleteitem",function(){"use strict";var a=function(a,b){var c,d,e,f,g,h,i;if(Array.isArray(a)){for(i=[],f=g=0,h=a.length;h>g;f=++g)c=a[f],f!==b&&i.push(c);return i}e={};for(d in a)d!==b&&(e[d]=a[d]);return e};return a}),define("fisheryates",["random"],function(a){"use strict";return function(b){for(var c=b.length-1;c>0;c--){var d=a(c+1),e=b[c];b[c]=b[d],b[d]=e}return b}}),function(){"use strict";define("requestfullscreen",function(){return function(a){a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen&&a.webkitRequestFullScreen()}}),define("fullscreenelement",function(){return function(a){return a.fullscreenElement||a.mozFullScreenElement||a.webkitFullscreenElement}}),define("cancelfullscreen",function(){return function(a){a.cancelFullScreen?a.cancelFullScreen():a.mozCancelFullScreen?a.mozCancelFullScreen():a.webkitCancelFullScreen&&a.webkitCancelFullScreen()}}),define("fullscreen",["requestfullscreen","fullscreenelement","cancelfullscreen"],function(a,b,c){return{request:a,isFullscreen:b,cancel:c}})}(),define("hbs",["handlebars","handlebars.runtime"],function(a,b){"use strict";return a&&a["default"]||b}),define("jqueryify",["jquery"],function(a){"use strict";return function(b){return b instanceof a?b:a(b)}}),define("nexttick",["requestanimationframe","cancelanimationframe"],function(a,b){"use strict";return function(c){var d=a(function(){null!=c&&c(),b(d)})}}),define("objectify",function(){"use strict";return function(a){if("object"!=typeof a)return{};if(!Array.isArray(a))return a;for(var b={},c=0,d=a.length;d>c;c++)null!=a[c]&&(b[c]=a[c]);return b}}),define("options",["jquery"],function(a){"use strict";return function(b,c){return a.extend(!0,b,c)}}),define("path",function(){"use strict";var a="/",b={join:function(b){var c=function(){for(var a=[],c=0,d=b.length;d>c;c++)null!=b[c]&&""!==b[c]&&a.push(b[c]);return a}();return c.join(a)},resolve:function(c,d){Array.isArray(d)||(d=d.split(a));var e=c.split(a),f=[],g=e.concat(d),h=g.length-1;(".."===g[h]||"."===g[h])&&(g[h]="");for(var i=0,j=g.length;j>i;i++)if(null!=g[i]&&""!==g[i]){if("."===g[i])continue;if(".."===g[i+1]){g[i]="",g[i+1]="";continue}f.push(g[i])}return b.join(f)},dotToPath:function(a){return a?~a.indexOf(".")?b.join(a.split(".")):a:void 0}};return b}),define("random",function(){"use strict";return function(a,b){return null==a&&(a=1),null==b&&(b=0),Math.floor(Math.random()*(a-b))+b}}),function(a){"use strict";define("root",function(){return a})}(this),define("lyria/game",["eventmap","mixedice","fullscreen","jquery","gameboard/loop","./viewport","./scene/director","./preloader","./world","./checkpoints"],function(a,b,c,d,e,f,g,h,i,j){"use strict";return function(){var k=function(e){var l=this;e=d.extend({startLoop:!0},e),b([this,k.prototype],new a),this.viewport=new f,this.viewport.parent=this,this.director=new g(this.viewport),this.director.parent=this,this.preloader=new h,this.preloader.parent=this,this.preloader.sceneDirector=this.director,this.paused=!1,this.mute=!1,this.world=new i,this.world.parent=this,this.checkpoints=new j,k.Loop.on("update",function(a){l.director.trigger("update",a)}),e.startLoop&&k.Loop.run(),this.on("pause",function(){l.paused=!0}),this.on("resume",function(){l.paused=!1}),this.on("fullscreen",function(){var a=l.viewport.$element[0];a&&(c.isFullscreen(a)?c.cancel(a):c.request(a))}),d(document).ready(function(){l.pause&&d(window).blur(function(){l.pause()}),l.resume&&d(window).focus(function(){l.resume()})})};return k.prototype.addScene=function(a,b){var c=this;if(!a)return this;if(Array.isArray(a))for(var d=0,e=a.length;e>d;d++)!function(a){"object"==typeof a?c.addScene(a.name,a.data):c.addScene(a)}(a[d]);return this.preloader.taskAsync(function(d){c.director.add(a,b,d)}),this},k.prototype.showScene=function(a){this.director.show(a)},k.Loop=e,k}()}),define("lyria/gameobject",["mixedice","eventmap","./component","./log"],function(a,b,c,d){"use strict";return function(){var e=function(){a([this,e.prototype],new b);var c=this;this.components={},this.className="gameobject",this.template={},this.template.source='<div id="{{id}}" class="{{className}}"></div>',this.on("update",function(a){_.isEmpty(c.components)||_.each(c.components,function(b,c){c.trigger("update",a)})})};return e.prototype.refresh=function(a){null==a&&this.template&&(a=this.template.data),this.template&&this.template.source&&(this.content=this.template.source(a)),this.trigger("refresh")},e.prototype.add=function(a){a instanceof c&&(this.components[a.name]=a)},e.prototype.execute=function(a){a.apply(this,this)},e.prototype.log=function(a){d.i("GameObject: "+a)},e}()}),define("lyria/language",["detectr","eventmap","./mixin/language"],function(a,b,c){"use strict";var d=new b,e={defaultLanguage:"en",on:d.on,off:d.off},f=a.Browser.language()||e.defaultLanguage;return c("value","change")(e,f,d),e}),define("lyria/layer",["mixedice","./gameobject"],function(a,b){"use strict";return function(){var c=function(){a(this.prototype,new b)};return c}()}),define("lyria/localization/group",["../localization"],function(a){"use strict";var b=function(){var b=function(b){for(var c in b){var d=b[c];this[c]=new a(d)}};return b}();return b}),define("lyria/localization",["./language","./template/string","./mixin/language"],function(a,b,c){"use strict";var d=function(){var d=function(b){null==b&&(b={}),this.data=b;var d=a.value;c("language","change")(this,d,this)};return d.elements=function(a,c,d){return null==d&&(d="en"),function(e,f){return a&&0!==Object.keys(a).length?(a[c]&&0!==Object.keys(a[c]).length||(c=d),a[c]?null==a[c][e]?"[[Missing localization for "+e+"]]":"string"==typeof a[c][e]?b.process(a[c][e],f):{plural:function(d){return a[c][e][d]?b.process(a[c][e][d],f):b.process(a[c][e].n,f)}}:"[[No language definition found for "+c+"]]"):"[[No language data found]]"}},d.prototype.exists=function(a){return!!(this.data&&this.data[this.language]&&this.data[this.language][a])},d.prototype.t=function(){return d.elements(this.data,this.language).apply(this,arguments)},d}();return d}),define("lyria/log",["root","gameboard/log"],function(a,b){"use strict";return a.log=a.out=b.i,b}),define("lyria/mixin/language",function(){"use strict";return function(a,b){return null==a&&(a="language"),null==b&&(b="language:change"),function(c,d,e){Object.defineProperty(c,a,{get:function(){return d},set:function(a){d=a,e.trigger(b,d)},configurable:!0,enumarable:!0})}}}),define("lyria/mixin/templatable",function(){"use strict";return function(){}}),define("lyria/prefab",["./scene"],function(a){"use strict";return a}),define("lyria/prefab/manager",["jqueryify","jquery","root"],function(a,b,c){"use strict";var d={};d.prefabs={},d.viewport=null,d.className="prefab",d.parent=null;var e=function(e){return function(f,g){var h=f.name,i=f.parent||f.target;g=g||f.data||{},null==f.wrap&&(f.wrap=!0);f.wrap;null==i&&(i=(d.viewport?d.viewport.$element:void 0)||"body");var j=null,k=h;k&&(k.indexOf(".")>=0&&(k=k.replace(/\./g,"--")),k.indexOf("/")>=0&&(k=k.replace(/\//g,"--")),k.indexOf("#")>=0&&(k=k.replace(/#/g,"--")));var l=d.className+"-"+k+"-"+Date.now();if(g.id=l,!d.prefabs[h])throw new Error("No valid prefab called "+h+" found.");j=d.prefabs[h](g);var m=a(i);return m&&(0===b("#"+j.name).length&&m[e](b(c.document.createElement("div")).attr("id",l).attr("class",d.className)),j.parent=d,j.isAsync||j.trigger("added",function(){j.trigger("active")})),j}};return d.append=function(){return e("append").apply(this,arguments)},d.prepend=function(){return e("prepend").apply(this,arguments)},d.insert=function(){return e("html").apply(this,arguments)},d}),define("lyria/preloader",["root","mixedice","jquery","./resource","./log","eventmap"],function(a,b,c,d,e,f){"use strict";var g=function(){var d=function(a){b([this,d.prototype],new f),this.assets=null!=a?a:{},this.maxAssets=0,this.assetsLoaded=0,this.percentLoaded=0,this.taskList=[]};return d.prototype.task=function(a){"function"==typeof a&&this.taskList.push({task:a,async:!1})},d.prototype.taskAsync=function(a){"function"==typeof a&&this.taskList.push({task:a,async:!0})},d.prototype.start=function(){if(null==this.assets)throw new Error("Assets should not be null. Pass at least an empty object.");this.trigger("start");var b=0;Object.keys(this.assets).length>0&&(b=this.assets.totalSize);var d=0,f=null!=this.sceneDirector&&null!=this.loadingScene;f&&this.sceneDirector.show(this.loadingScene);var g=this,h=function(a){var b=g.taskList.length,c=0,d=function(){c===b&&a()},e=function(){c++,d()};if(0===g.taskList.length)a();else for(var f=0,h=g.taskList.length;h>f;f++)!function(a){a.async?a.task.call(this,e):(a.task(),e())}(g.taskList[f])},i=function(){var a=100;d!==b&&(a=d/b),g.trigger("progress",a),f&&g.sceneDirector.currentScene.trigger("progress",a,d,b),d>=b&&h(function(){f&&g.sceneDirector.currentScene.trigger("complete"),g.trigger("complete")})},j=function(a){return function(){d+=a.size,g.assetsLoaded++,i()}},k=function(a){return function(b){e.e("Error while loading "+a.name+": "+b)}},l={mp3:"audio/mpeg",wav:"audio/wav",ogg:"audio/ogg"};Object.keys(this.assets).length>0?c.each(this.assets,function(b,d){if(null==d.files||!Array.isArray(d.files)||0===d.files.length)return!0;g.maxAssets+=d.files.length;for(var f=0,h=d.files.length;h>f;f++)!function(b){if(0===b.type.indexOf("image")){var d=new a.Image;d.onload=j(b),d.onerror=k(b),d.src=b.name}else if(0===b.type.indexOf("audio")){var f=b.name.split(".").pop(),g=new a.Audio;l[f]&&g.canPlayType(l[f])?(g.addEventListener("canplaythrough",j(b)),g.onerror=k(b),g.src=b.name,g.load()):(e.w("Skipped unsupported audio file ("+l[f]+") "+b.name),j(b)())}else c.ajax({url:b.name,dataType:"text"}).always(j(b)).error(k(b))}(d.files[f])}):i()},d}();return g}),define("lyria/resource",["path"],function(a){"use strict";var b={path:{assets:"assets",audio:"audio",data:"data",image:"images",scene:"scenes",video:"video",prefab:"prefabs"},name:function(c,d){if(c){var e=b.path.assets,f=b.path[d]?b.path[d]:d;return a.resolve(e,[a.dotToPath(f),c])}}};return b}),define("lyria/scene/director",["require"],function(a){"use strict";var b=a("root"),c=a("mixedice"),d=a("jquery"),e=a("eventmap"),f=a("../scene"),g=a("../viewport");return function(){function a(b,d){c([this,a.prototype],new e),this.viewport=b instanceof g?b:new g(b,{parent:d}),this.sceneList={},this.className="scene",this.currentScene=null,this.defaultScene=null,this.on("render",function(){this.currentScene&&this.currentScene.trigger("render")}),this.on("update",function(a){this.currentScene&&this.currentScene.trigger("update",a)})}return a.prototype.add=function(a,c,e){"*"===a&&this.scenes&&(a=Object.keys(this.scenes));{if(!Array.isArray(a)){if(this.scenes&&Object.keys(this.scenes).length>0&&this.scenes[a])a=this.scenes[a](c);else if(a instanceof f)c&&(a.data=c),this.scenes[a.name]=a;else{if("function"!=typeof a)throw new Error("No valid scene found.");var g=a(c);this.scenes[g.name]=g}return a.parent=this,null!=this.parent&&(a.game=this.parent),0===Object.keys(this.sceneList).length&&(this.defaultScene=a.name),this.sceneList[a.name]=a,this.viewport.$element&&0===d("#"+a.name).length&&this.viewport.$element.prepend(d(b.document.createElement("div")).attr("id",a.name).attr("class",this.className)),a.trigger("added",e),this}for(var h=0,i=a.length;i>h;h++)this.add(a[h],c,e)}},a.prototype.show=function(a,b,c){if(a){d("."+this.className+":visible")&&d("."+this.className).hide(),this.currentScene&&(this.currentScene.transition&&this.currentScene.length?d("#"+this.currentScene).hide(this.currentScene.transition.length,function(){d("."+this.className).hide()}):d("."+this.className).hide(),this.currentScene.trigger("deactivate",b));var e=this;if(e.currentScene=this.sceneList[a],null==e.currentScene)throw new Error("Scene "+a+" not found.");e.currentScene.transition&&e.currentScene.transition.length?d("#"+a).show(e.currentScene.transition.length):d("#"+a).show(),this.trigger("scene:change",a),e.currentScene.trigger("active",b),c&&c(a)}},a.prototype.refresh=function(a){var b=a?this.sceneList[a]:this.currentScene;b.refresh()},a}()}),define("lyria/scene",["require"],function(a){"use strict";var b=a("jquery"),c=a("mixedice"),d=a("nexttick"),e=a("./component"),f=a("./gameobject"),g=(a("./log"),a("./localization")),h=function(a,b,c){if(Array.isArray(b))for(var d=0,e=b.length;e>d;d++)h(a,b[d],c);else for(var f=b.split("."),g=0,i=f.length;i>g;g++)!function(b,d){a[b]=d?c:a[b]||{},a=a[b]}(f[g],g===i-1)},i=function(){var i=function(f,j,k,l){if(!f)throw new Error("A scene needs to have a name");"function"==typeof j&&(k=j,j={}),l=l||{},c([this,i.prototype],new e(f));var m=this;this.type="Scene",this.data=l.data||{},this.localization=new g,this.defaultEvent=null,this.DOMEvents={},this.template={},this.template.source=null,this.template.helpers={},this.template.partials={},this.template.data={},this.children=this.children||{},this.children.gameObjects={},this.children.prefabs={},this.id=this.data.id||m.name,this.expose=function(a){a&&!b.isEmptyObject(a)&&(m.template.data=b.extend(!0,m.template.data,a))},Object.defineProperty(m,"$element",{get:function(){return b("#"+m.id)}}),m.on("synchronize",function(a){m.refresh(),m.DOMEvents&&!b.isEmptyObject(m.DOMEvents)&&(m.DOMEvents.delegate="#"+m.id),m.on("update",function(a){b.each(m.children,function(c,d){b.isEmptyObject(d)||b.each(d,function(b,c){c.trigger("update",a)})})}),m.DOMEvents&&!b.isEmptyObject(m.DOMEvents)&&b.each(m.DOMEvents,function(a,c){"object"==typeof c&&"delegate"!==a&&b(m.DOMEvents.delegate).on(c,a,{scene:m})}),m.template.data&&!b.isEmptyObject(m.template.data)&&m.$element.find("[data-bind]").each(function(){var a=b(this),c=a.data("bind");m.template.data.watch(c,function(b,c,d){return c!==d&&a.html(d),d})}),a&&a()});var n=function(a,b){var c=function(a){return a?(console.error("Error while executing scene "+m.name+": "+a),void(a.stack&&console.error(a.stack))):void m.trigger("synchronize",b)},e=!1,f=m;f.async=function(){return e=!0,function(){d(function(){c()})}},m.hasOwnProperty("isAsync")||Object.defineProperty(m,"isAsync",{get:function(){return e}}),f.modules=a;try{var g=k.apply(f,[f,a]);e||c(null,g)}catch(h){c(h)}},o=Object.keys(i.requireAlways)||[];m.on("added",function(b){a(o,function(){for(var c={},d=0,e=arguments.length;e>d;d++)!function(a){h(c,i.requireAlways[o[d]],a)}(arguments[d]);j=j||{};var f=Object.keys(j)||[];f.length?a(f,function(){for(var a=0,d=arguments.length;d>a;a++)!function(a){h(c,j[f[e]],a)}(arguments[e]);n(c,b)}):n(c,b)})})};return i.prototype.add=function(a){var c=this;return a instanceof f?(this.children.gameObjects[a.name]=a,this.template.data.gameobject=function(){var a=[];return b.each(c.children.gameObjects,function(b,c){a.push(c)}),a}(),this.trigger("add"),!0):a instanceof f?(this.children.prefabs[a.name]=a,this.template.data.gameobject=function(){var a=[];return b.each(c.children.gameObjects,function(b,c){a.push(c)}),a}(),this.trigger("add"),!0):!1},i.prototype.refresh=function(a){null==a&&this.template&&(a=this.template.data),this.template.helpers.translate=g.elements(this.localization.data,this.localization.language),this.template&&this.template.source&&(this.content=this.template.source(a,{partials:this.template.partials,helpers:this.template.helpers})),this.$element.length>0&&this.$element.html(this.content),this.trigger("refresh")},i.prototype.bindEvent=function(a,b,c){if(null!=a){var d=this.defaultEvent||i.defaultEvent;if(this.DOMEvents[a]=this.DOMEvents[a]||{},"function"==typeof b)this.DOMEvents[a][d]=b;else{if("string"!=typeof b)throw new Error("If you meant to bind more than one event, please use Scene#bindEvents");this.DOMEvents[a][b]=c}}},i.prototype.bindEvents=function(a){if(null!=a)for(var b in a)Object.hasOwnProperty.call(a,b)&&(this.DOMEvents[b]=a[b])},i.prototype.unbindEvent=function(a,b){null!=a&&(null==b?delete this.DOMEvents[a]:delete this.DOMEvents[a][b])},i.prototype.unbindEvents=function(a){if(null==a||"*"===a)return void(this.DOMEvents={});if(Array.isArray(a))for(var b=0,c=a.length;c>b;b++)this.DOMEvents[a[b]]&&delete this.DOMEvents[a[b]];else for(var d in a)if(Object.hasOwnProperty.call(a,d)){var e=a[d];if(Array.isArray(e))for(var f=0,g=e.length;g>f;f++)delete this.DOMEvents[d][e[f]];else delete this.DOMEvents[d][e]}},i.prototype.behavior=function(a,b,c){this.bindEvent("[data-behavior~="+a+"]",b,c)},i.prototype.t=function(){return this.localization&&this.localization.t?this.localization.t.apply(this.localization,arguments):void 0},i.defaultEvent="click",i.requireAlways={jquery:["jQuery","$"],"lyria/achievement":"Lyria.Achievement","lyria/achievement/manager":"Lyria.AchievementManager","lyria/animation":"Lyria.Animation","lyria/audio":"Lyria.Audio","lyria/checkpoints":"Lyria.Checkpoints","lyria/component":"Lyria.Component","lyria/gameobject":"Lyria.GameObject","lyria/log":"Lyria.Log","lyria/prefab/manager":"Lyria.PrefabManager","lyria/resource":"Lyria.Resource","lyria/tween":"Lyria.Tween"},i}();return i}),define("lyria/serialize",["jquery"],function(a){"use strict";var b=function(b){return void 0===b||b instanceof a?void 0:"function"==typeof b?b.toString():JSON.stringify(b,function(b,c){return c instanceof a?null:("function"==typeof c&&(c=c.toString()),c)})};return b}),define("lyria/sprite",function(){"use strict";var a=function(){var a=function(){};return a}();return a}),define("lyria/sprite/manager",["jquery","mixedice","../component","../sprite/renderer"],function(a,b,c){"use strict";var d=function(){var a=function(){var d="SpriteManager";b([this,a.prototype],new c(d)),this.type=d};return a}();return d}),define("lyria/sprite/renderer",function(){}),define("lyria/template/connector",["./methods"],function(a){"use strict";var b=function(){};return function(){for(var c=function(a){if("object"==typeof a){var b,c;for(b in a)c=a[b],"function"==typeof c&&(this[b]=c)}},d=0,e=a.length;e>d;d++)!function(a){c.prototype[a]=b}(a[d]);return c}()}),define("lyria/template/engine",["hbs","./connector","./methods"],function(a,b,c){"use strict";var d=function(){},e=function(a){if(a instanceof b)for(var f=0,g=c.length;g>f;f++)!function(b){e[b]=null!=a[b]&&"function"==typeof a[b]?a[b]:d}(c[f])};if(a){var f=new b({compile:function(){return a.template.apply(this,arguments)},globalHelpers:function(){return a.helpers}});new e(f)}return e}),define("lyria/template/methods",function(){"use strict";return["compile"]}),define("lyria/template/string",["objectify"],function(a){"use strict";var b={key:{start:"\\{{",end:"\\}}"},process:function(c,d){if(null!=c){if(null==d)return c;if("object"==typeof d)for(var e=a(d),f=Object.keys(e),g=0,h=f.length;h>g;g++)!function(a,d){c=c.replace(new RegExp(b.key.start+a+b.key.end,"g"),d)}(f[g],e[f[g]]);return c}}};return b}),define("lyria/tween",["eventmap","mixedice","options","jqueryify"],function(a,b,c,d){"use strict";var e=function(){var e=function(f){f=c(f,{elem:null,effects:[{property:null,target:null,easing:e.defaults.easing,duration:e.defaults.duration,delay:e.defaults.delay}]}),this.$elem=d(f.elem),this.effects=f.effects,this.hwAccelerated=!0,b([this,e.prototype],new a);var g=this;this.on("start",function(){if(!g.$elem){for(var a=[],b={},c=0,d=g.effects.length;d>c;c++)!function(c){null!=c.property&&null!=c.target&&(c.duration=c.duration||e.defaults.duration,c.easing=c.easing||e.defaults.easing,c.delay=c.delay||e.defaults.delay,a.push([c.property,c.duration,c.easing,c.delay].join(" ")),b[c.property]=c.target)}(g.effects[c]);b.transition=a.join(", "),g.$elem.css(b),$(document).one("transitionend",function(a){console.log(a.target)})}})};return e.defaults={easing:"linear",duration:"300ms",delay:"0ms"},e}();return e}),define("lyria/video",function(){"use strict";var a=function(){var a=function(){};return a.prototype.loadFromFile=function(){},a.prototype.play=function(){},a.prototype.pause=function(){},a.prototype.stop=function(){},a}();return a}),define("lyria/viewport",["root","jquery","mixedice","eventmap"],function(a,b,c,d){"use strict";return function(){function e(f,g){var h={parent:null,trigger:{element:window,event:"resize"},scaleMode:"scaleToFit"};if(g=b.extend(h,g),c([this,e.prototype],new d),this.scale={},this.scale.mode=g.scaleMode,this.scale.x=1,this.scale.y=1,null==f&&(f="viewport"),Object.defineProperty(this,"$element",{get:function(){return b("#"+f)}}),0===this.$element.length){var i=b(a.document.createElement("div")).attr("id",f).attr("class","viewport");g.parent?b(g.parent).prepend(i):b("body").prepend(i)}Object.defineProperty(this,"width",{get:function(){return this.$element.outerWidth()}}),Object.defineProperty(this,"height",{get:function(){return this.$element.outerHeight()}});var j=this;this.on("scale",function(){var a=function(a,b){null==b&&(b=a);var c="scale("+a+", "+b+")";j.$element.css("transform",c),(j.scale.x!==a||j.scale.y!==b)&&(j.scale.x=a,j.scale.y=b,j.trigger("scale:change",j.scale.x,j.scale.y))},c=function(c){var d=0;return j.height>b(g.trigger.element).innerHeight()?(d=b(g.trigger.element).innerHeight()/j.height,c?d:(a(d),d)):1},d=function(c){var d=0;return j.width>b(g.trigger.element).innerWidth()?(d=b(g.trigger.element).innerWidth()/j.width,c?d:(a(d),d)):1};switch(j.scale.mode){case"stretch":break;case"cover":break;case"scaleToFit":var e=1,f=1;b(g.trigger.element).innerHeight()<j.height&&(f=c(!0)),b(g.trigger.element).innerWidth()<j.width&&(e=d(!0)),a(Math.min(e,f));break;case"scaleHeightToFit":c();break;case"scaleWidthToFit":d()}}),b(g.trigger.element).on(g.trigger.event,function(){j.trigger("scale")}),j.trigger("scale")}return e.prototype.fitToAspectRatio=function(a){var c=b(window).width()/b(window).height();switch(a){case"width":var d=this.height*c;this.$element.width(d),this.$element.css("margin-left",d/-2+"px");break;case"height":var e=this.width/c;this.$element.height(e),this.$element.css("margin-top",e/-2+"px")}},e}()}),define("lyria/world/data",function(){"use strict";var a=function(){var a=function(){};return a}();return a}),define("lyria/world",["mixedice","eventmap","lyria/world/data"],function(a,b,c){"use strict";var d=function(){var d=function(){a([this,d.prototype],new b),this.events=new b,this.data=new c(this),this.register({name:"state",value:""})};return d.prototype.register=function(a){var b=a.name,c=a.value,d=a.constant,e=this,f=function(a){return e.trigger("value",b,c),e.trigger(b+":value",c),a},g=function(a){c!==a&&(c=a,e.trigger("change",b,c),e.trigger(b+":change",c))},h={get:f};d&&(h.set=g),Object.defineProperty(this,b,h)},d.prototype.initialize=function(){},d.prototype.reset=function(){},d.prototype.serialize=function(){return JSON.stringify(this)},d.prototype.deserialize=function(){},d}();return d}),define("lyria/template/list",{"achievement-list":{1:function(a,b,c,d){var e,f="";return e=this.invokePartial(c.achievement,"    ","achievement",a,void 0,b,c,d),null!=e&&(f+=e),f},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f='<div class="achievement-list">\n';return e=b.each.call(a,null!=a?a.achievement:a,{name:"each",hash:{},fn:this.program(1,d),inverse:this.noop,data:d}),null!=e&&(f+=e),f+"</div>"},usePartial:!0,useData:!0},achievement:{1:function(){return"offscreen"},3:function(a,b,c,d){var e,f="function",g=b.helperMissing,h=this.escapeExpression;return'  <div class="progress-status">\n    <span class="current">'+h((e=null!=(e=b.current||(null!=a?a.current:a))?e:g,typeof e===f?e.call(a,{name:"current",hash:{},data:d}):e))+'</span>\n    <span class="separator">'+h((e=null!=(e=b.separator||(null!=a?a.separator:a))?e:g,typeof e===f?e.call(a,{name:"separator",hash:{},data:d}):e))+'</span>\n    <span class="max">'+h((e=null!=(e=b.max||(null!=a?a.max:a))?e:g,typeof e===f?e.call(a,{name:"max",hash:{},data:d}):e))+"</span>\n  </div>\n"
},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f,g="function",h=b.helperMissing,i=this.escapeExpression,j='<div id="'+i((f=null!=(f=b.id||(null!=a?a.id:a))?f:h,typeof f===g?f.call(a,{name:"id",hash:{},data:d}):f))+'" class="achievement ';return e=b["if"].call(a,null!=a?a.offscreen:a,{name:"if",hash:{},fn:this.program(1,d),inverse:this.noop,data:d}),null!=e&&(j+=e),j+='">\n  <div class="title">'+i((f=null!=(f=b.title||(null!=a?a.title:a))?f:h,typeof f===g?f.call(a,{name:"title",hash:{},data:d}):f))+'</div>\n  <div class="icon '+i((f=null!=(f=b.className||(null!=a?a.className:a))?f:h,typeof f===g?f.call(a,{name:"className",hash:{},data:d}):f))+'"></div>\n  <div class="description">'+i((f=null!=(f=b.description||(null!=a?a.description:a))?f:h,typeof f===g?f.call(a,{name:"description",hash:{},data:d}):f))+"</div>\n",e=b["if"].call(a,null!=a?a.progressable:a,{name:"if",hash:{},fn:this.program(3,d),inverse:this.noop,data:d}),null!=e&&(j+=e),j+"</div>"},useData:!0},scene:{1:function(a,b,c,d){var e,f="function",g=b.helperMissing,h=this.escapeExpression;return'  <canvas id="'+h((e=null!=(e=b.name||(null!=a?a.name:a))?e:g,typeof e===f?e.call(a,{name:"name",hash:{},data:d}):e))+'" class="'+h((e=null!=(e=b.type||(null!=a?a.type:a))?e:g,typeof e===f?e.call(a,{name:"type",hash:{},data:d}):e))+'"></canvas>\n'},3:function(a,b,c,d){var e,f="function",g=b.helperMissing,h=this.escapeExpression;return'  <div id="'+h((e=null!=(e=b.name||(null!=a?a.name:a))?e:g,typeof e===f?e.call(a,{name:"name",hash:{},data:d}):e))+'" class="'+h((e=null!=(e=b.type||(null!=a?a.type:a))?e:g,typeof e===f?e.call(a,{name:"type",hash:{},data:d}):e))+'"></div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return e=b["if"].call(a,null!=a?a.canvas:a,{name:"if",hash:{},fn:this.program(1,d),inverse:this.program(3,d),data:d}),null!=e?e:""},useData:!0}});