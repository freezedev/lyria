/*! lyria 20-04-2013 */
(function(e,t,n){"use strict";t.Achievements=function(){var t,i={},o=function(n){t=n,e.localStorage&&e.localStorage[t]&&(i=JSON.parse(e.localStorage[t]))},r=function(e,t,n){i[e]={active:!1},t!==undefined&&(i[e].description=t),n!==undefined&&(i[e].icon=n)},a=function(){return Object.keys(i).length},s=function(){var e=0;for(var t in i)i[t].active&&e++;return e},c=function(){var e="";for(var t in i)e+=i[t].active?'<div class="ach_box unlocked"><span class="ach_unlocked">'+t+'</span><br /><span class="ach_details">'+i[t].description+"</span></div><br /><br />":'<div class="ach_box locked"><span class="ach_locked">'+t+'</span><br /><span class="ach_details">'+i[t].description+"</span></div><br /><br />";return e},u=function(o){"undefined"===i[o]&&r(o),i[o].active||(i[o].icon||n(".status.achievement").css("background-image","url("+i[o].icon+")"),n(".achievement .text").html(o),n(".status.achievement").css({opacity:0}).animate({opacity:1,bottom:"8px"},750).delay(2500).animate({opacity:0,bottom:"-80px"},750),i[o].active=!0),e.localStorage&&(e.localStorage[t]=JSON.stringify(i))};return{initialize:o,getCount:a,getUnlockedCount:s,list:c,register:r,show:u}}()})(this,this.Lyria=this.Lyria||{},this.jQuery),define("lyria/resource",{path:{assets:"assets",audio:"audio",data:"data",image:"images",scene:"scenes",video:"video",prefab:"prefabs"},name:function(e,t){if(e){var n=Lyria.Resource.path.assets,i="";return i=Lyria.Resource.path[t]?Lyria.Resource.path[t]:t,i?[n,i.split(".").join("/"),e].join("/"):[n,e].join("/")}}}),function(e,t,n,i){"use strict";n.Audio=function(){var n=!1,o={},r=function(e,n){if(n&&"object"==typeof n){var r=t.createElement("audio");o[e]=n,i(r).attr("id",e).attr("preload","auto").append('<source src="'+n.filepath+'" />'),i("body").append(r),n.play&&this.play(e)}},a=function(t){t&&"string"==typeof fileObj&&(i("#"+t).remove(),e.log("Lyria.audio.removeAudioElement: "+t+" removed"))},s=function(t){o[t],i("#"+t).one("ended",{audioManager:this},function(t){e.chrome?i(this).load():i(this).currentTime=0;var n=i(this).attr("id"),o=t.data.audioManager.getSound(n);o.playAfter&&i("#"+o.playAfter).length>0&&t.data.audioManager.play(o.playAfter),o.loop&&t.data.audioManager.play(i(this).attr("id"))}),i("#"+t)[0].play(),n&&(i("#"+t)[0].volume=0)},c=function(e){return o[e]},u=function(t){i("#"+t).length>0?i("#"+t)[0].pause():e.log("error","Lyria.Audio.pause: cant finde element "+t+" to pause")},l=function(e){i("#"+e).length>0&&i("#"+e)[0]&&i("#"+e)[0].pause&&(i("#"+e)[0].pause(),i("#"+e)[0].currentTime=0)},f=function(e){return i("#"+e)[0].duration},p=function(e,t){return i("#"+e).length>0?"number"!=typeof t?i("#"+e)[0].volume:(i("#"+e)[0].volume=t,undefined):0},d=function(e,t){return"number"!=typeof t?i("#"+e)[0].currentTime:(i("#"+e)[0].currentTime=t,undefined)},h=function(e,t){switch(e){case"duration":case"length":return f();case"position":case"pos":if(t===undefined)return d();d(t);break;case"volume":if(t===undefined)return p();p(t)}},y=function(e){n=e;for(var t in o)o.hasOwnProperty(t)&&i("#"+t).length>0&&(i("#"+t)[0].volume=e?0:1)};return{addAudioElement:r,removeAudioElement:a,play:s,getSound:c,pause:u,stop:l,muteSounds:y,getLength:f,volume:p,pos:d,attr:h}}}(this,this.document,window.Lyria=window.Lyria||{},this.jQuery),define("lyria/component",function(){return function(){function e(e){this.name=null!=e?e:this.constructor.name}return e.prototype.register=function(){},e.prototype.unregister=function(){},e.prototype.render=function(){},e.prototype.update=function(){},e}()}),define("lyria/debug",function(){return!0}),define("lyria/constants",{animSpeed:300}),function(e){e.frameRate=60;for(var t=["ms","moz","webkit","o"],n=0;t.length>n&&!e.requestAnimationFrame;++n)e.requestAnimationFrame=e[t[n]+"RequestAnimationFrame"],e.cancelRequestAnimationFrame=e[t[n]+"CancelRequestAnimationFrame"];e.requestAnimFrame||(e.requestAnimFrame=function(t){e.setTimeout(t,~~(1e3/e.frameRate))}),e.cancelAnimationFrame||(e.cancelAnimationFrame=function(e){clearTimeout(e)})}(this),function(e,t,n){"use strict";t.defaultLanguage="en",t.Language=n.Browser.language()||t.defaultLanguage}(this,this.Lyria=this.Lyria||{},this.detectr),function(e,t){t.Entity=function(){function e(e){this.name=null!=e?e:this.constructor.name,this.components={},t={}}var t;return t={},e.prototype.add=function(e){var n,i,o,r;if(!e)return this;if(i=e.name,n=this.components[i],!n){n=e,"function"==typeof n.register&&n.register();for(o in n)r=n[o],"constructor"!==o&&"function"==typeof r&&(t[o]||(t[o]=[]),t[o].push(r),this[o]||(this[o]=function(e){return function(){var n,i,o,r;for(r=t[e],i=0,o=r.length;o>i;i++)n=r[i],n.apply(this,arguments);return this}}(o)))}return this},e.prototype.remove=function(e){var t;return this.components[e]&&("function"==typeof(t=this.components[e]).unregister&&t.unregister(),delete this.components[e]),this},e.prototype.render=function(){var e,t,n;n=this.components;for(e in n)t=n[e],"function"==typeof t.render&&t.render();return this},e.prototype.update=function(e){var t,n,i;i=this.components;for(t in i)n=i[t],"function"==typeof n.update&&n.update(e);return this},e}()}(this,this.Lyria=this.Lyria||{}),function(e,t){"use strict";t.Event={Map:{click:{mobile:"touchend"}}};var n=[].slice;t.EventMap=function(){function t(){o={},i={}}var i,o;return o={},i={},t.prototype.validEvents=[],t.prototype.on=function(e,t){return!t||this.validEvents.length>0&&-1===validEvents.indexOf(e)?undefined:(o[e]={event:t,id:-1,type:""},this)},t.prototype.off=function(t){return t?(("once"===o[t].type||"repeat"===o[t].type)&&("repeat"===o[t].type&&e.clearInterval(o[t].id),"once"===o[t].type&&e.clearTimeout(o[t].id)),o[t]&&delete o[t],this):undefined},t.prototype.trigger=function(){var t,i,r,a,s,c,u;return r=arguments[0],t=arguments.length>=2?n.call(arguments,1):[],null!=r?("object"==typeof r?(s=r.name,a=r.interval,c=r.repeat,i=r.context):s=r,null==a&&(a=0),null==c&&(c=!1),null==i&&(i=this),u=function(){return o[s]?o[s].event.apply(i,t):undefined},a?c?(o[s].type="repeat",o[s].id=e.setInterval(u,a)):(o[s].type="once",o[s].id=e.setTimeout(u,a)):(o[s].type="direct",u.call(this)),this):undefined},t}(),t.Events=new t.EventMap}(this,this.Lyria=this.Lyria||{}),define("lyria/game",["lyria/viewport","lyria/scene/director"],function(e,t){"use strict";return function(){var n=function(){};return n.prototype.viewport=new e,n.prototype.director=new t(n.prototype.viewport),n.prototype.preloader=null,n}()}),define("lyria/gameobject",function(){"use strict";return function(){var e=function(){};return e.prototype.add=function(){},e.prototype.execute=function(){},e.prototype.log=function(){},e}()}),function(e){"use strict";e.Layer=function(e){var t=function(){};return t.prototype=e.prototype,t}(e.GameObject)}(window.Lyria=window.Lyria||{}),function(e,t,n){"use strict";t.Localization=function(){var i=function(i,o){if(i){var r={},a={language:t.Language};o=n.extend(!0,a,o);var s={};e.check(i,{object:function(e){s=e},string:function(e){n.ajax({url:e,async:!1,dataType:"json",success:function(e){s=e}})}}),r=s[o.language],r||(r=s[t.DefaultLanguage]),this.localizeLangObject=r}};return i.prototype.get=function(e,t){return this.localizeLangObject&&this.localizeLangObject[e]?this.localizeLangObject[e]:e||t?e?t?t:e:t:this.localizeLangObject},i}(),t.GlobalLocalization=new t.Localization(t.Resource.name("i18n.json"))}(this,this.Lyria=this.Lyria||{},this.jQuery),define("lyria/log",["root"],function(e){"use strict";var t=function(){var t={};t.Connector=null,t.Plugins={},t.Plugins.Console={e:function(t){e.console&&e.console.error&&e.console.error(t)},w:function(t){e.console&&e.console.warn&&e.console.warn(t)},i:function(t){e.console&&e.console.info&&e.console.info(t)},d:function(t){e.console&&e.console.log&&e.console.log(t)},v:function(t){e.console&&e.console.log&&e.console.log(t)}},t.Connector=t.Plugins.Console,t.logLevelMap={error:["e"],warn:["w","e"],info:["i","w","e"],debug:["d","i","w","e"],verbose:["v","d","i","w","e"]},t.logLevel="verbose";for(var n=["v","d","i","w","e"],i=0,o=n.length;o>i;i++)(function(e){t[e]=function(){t.logLevelMap[t.logLevel].indexOf(e)>=0&&t.Connector[e].apply(this,arguments)}})(n[i]);return t}();return e.log=e.out=Lyria.Log.i,t}),define("lyria/loop",["root"],function(e){"use strict";return function(){var t={},n=!0,i=function(){var i;(function o(){e.requestAnimFrame(o);var r=Date.now(),a=r-(i||r);i=r,n&&$.each(t,function(e,t){t.paused||t.value(a)})})()},o=function(){n=!1},r=function(){t={}},a=function(e,n){t[e]={paused:!1,value:n}},s=function(e){t[e].paused=!0},c=function(e){t[e].paused=!1},u=function(e){delete t[e]};return{run:i,stop:o,clear:r,addTask:a,removeTask:u,pauseTask:s,resumeTask:c}}()}),define("lyria/prefab",["lyria/scene","jquery"],function(e,t){"use strict";return function(e,n){var i={target:null,template:"prefab.html",data:"prefab.js",path:"prefab",isPrefab:!0};return n=t.extend(!0,i,n),Lyria.Scene(e,n)}}),define("lyria/preloader",["checkt","jquery"],function(e,t){"use strict";var n={maxAssets:0,assetsLoaded:0,percentLoaded:0,init:function(e,i){function o(){n.percentLoaded=n.assetsLoaded/n.maxAssets,n.onProgressChange&&n.onProgressChange(n.percentLoaded),i.showLoadingScreen,n.assetsLoaded===n.maxAssets&&(i.showLoadingScreen,n.complete&&"function"==typeof n.complete&&n.complete())}var r={showLoadingScreen:!0,loadingScreenClass:"loading-screen",loadingBarClass:"loading-bar"};i=t.extend(!0,r,i),e.length&&(n.maxAssets=e.length,t.each(e,function(e,i){global.check(i,{object:function(){},string:function(e){if(e.contains("/"+Lyria.Resource.path.image+"/")){var i=new global.Image;i.onload=function(){n.assetsLoaded++,o()},i.onerror=function(){global.Log.e("Error while loading "+e)},i.src=e}else t.ajax({url:e,dataType:"text"}).always(function(){n.assetsLoaded++,o()}).error(function(t){global.Log.e("Error while loading "+e+": "+t)})}})}))},onProgressChange:function(){},complete:function(){}};return n}),function(e,t,n,i){"use strict";n.SceneDirector=function(){function e(e,t){this.viewport=e instanceof n.Viewport?e:new n.Viewport(e,t),this.sceneList={},this.currentScene=null,this.onSceneChange=function(){}}return e.prototype.sceneClassName="scene",e.prototype.add=function(o){if(!(o instanceof n.Scene)){if(!n.Scenes[o])throw"No valid scene found.";o=n.Scenes[o]}return o.parent=this,this.sceneList[o.name]=o,this.viewport.$container&&0===i("#"+o.name).length&&(this.viewport.$container.prepend(i(t.createElement("div")).attr("id",o.name).attr("class",e.prototype.sceneClassName)),o.content&&i("#"+o.name).html(o.content),o.events&&!i.isEmptyObject(o.events)&&i.each(o.events,function(e,t){"object"==typeof t&&"delegate"!==e&&i(o.events.delegate).on(t,e,{scene:o})})),this},e.prototype.show=function(t,n,o){this.onSceneChange&&this.onSceneChange(t),i("."+e.prototype.sceneClassName+":visible")&&i("."+e.prototype.sceneClassName).hide(),this.currentScene&&(this.currentScene.transition&&this.currentScene.length?i("#"+this.currentScene).hide(this.currentScene.transition.length,function(){i("."+e.prototype.sceneClassName).hide()}):i("."+e.prototype.sceneClassName).hide(),this.currentScene.onDeactivated&&this.currentScene.onDeactivated(n)),i.each(this.sceneList,function(e,r){return e===t?(t.transition&&t.transition.length?i("#"+t).show(t.transition.length):i("#"+t).show(),this.currentScene=r,this.currentScene.onActive&&this.currentScene.onActive(n),o&&o(t),!1):undefined})},e.prototype.render=function(){this.currentScene.render&&this.currentScene.render()},e.prototype.update=function(e){this.currentScene.update&&this.currentScene.update(e)},e}()}(this,this.document,this.Lyria=this.Lyria||{},this.jQuery),function(e,t,n){"use strict";t.Scene=function(){var e=function(e,i,o){if(e){var r=this;this.name=e,this.eventMap=new t.EventMap,this.localization={};var a={},s=i.call(a,this);n.each(a,function(e,t){r[e]||(r[e]=t)}),this.template&&(this.content=this.template(s)),this.events&&(this.events.delegate=o&&o.isPrefab?o.target?o.target:"body":"#"+e)}};e.prototype.add=function(e){e instanceof t.GameObject};for(var i=Object.keys(t.EventMap.prototype),o=0,r=i.length;r>o;o++)(function(t){e.prototype[t]=function(){this.eventMap[t].apply(this,arguments)}})(i[o]);return e}(),t.Scenes={}}(this,this.Lyria=this.Lyria||{},this.jQuery,this.Handlebars),function(e,t,n){var i=function(){},o=["compile"];if(n.TemplateConnector=function(){for(var e=function(e){if("object"==typeof e){var t,n;for(t in e)n=e[t],"function"==typeof n&&(this[t]=n)}},t=0,n=o.length;n>t;t++)(function(t){e.prototype[t]=i})(o[t]);return e}(),n.TemplateEngine=function(e){if(e instanceof n.TemplateConnector)for(var t=0,r=o.length;r>t;t++)(function(t){n.TemplateEngine[t]=null!=e[t]&&"function"==typeof e[t]?e[t]:i})(o[t])},e.Handlebars){var r=new n.TemplateConnector({compile:function(){return e.Handlebars.template.apply(this,arguments)}});n.TemplateEngine(r)}}(this,this.jQuery,this.Lyria=this.Lyria||{}),function(e,t){"use strict";e.Utils={},e.Utils.isFile=function(e){var t=e.indexOf(".");if(-1===t)return!1;var n=e.length,i=n-t;return i>1&&5>=i?!0:!1},e.Utils.cloneObject=function(e){return t.extend(!0,{},e)},e.Utils.serializeObject=function(n){if(!("object"!=typeof n||n instanceof t)){var i="{";for(var o in n)if(n.hasOwnProperty(o)){if(n[o]instanceof t)continue;var r=Object.keys(n),a=r.indexOf(o)===r.length-1?"":",";switch(typeof n[o]){case"object":i+=o+": "+e.Utils.serializeObject(n[o])+a+"\n";break;case"string":i+=o+': "'+n[o]+'"'+a+"\n";break;default:i+=o+": "+n[o]+a+"\n"}}return i+="}"}}}(this.Lyria=this.Lyria||{},this.jQuery),function(e){"use strict";e.Video=function(){var e=function(){};return e.prototype.loadFromFile=function(){},e.prototype.play=function(){},e.prototype.pause=function(){},e.prototype.stop=function(){},e}()}(this.Lyria=this.Lyria||{}),function(e){"use strict";e.Viewport=function(){function e(e,t){if(null==e&&(e="viewport"),$("#"+e).length>0)this.$container=$("#"+e);else{var n=$(document.createElement("div")).attr("id",e);t?$(t).prepend(n):$("body").prepend(n),this.$container=$("#"+e)}}return e.prototype.scale=function(e,t){null!=e&&(null==t&&(t=e),this.$container.css("transform","scale("+e+","+t+")"))},e.prototype.center=function(){},e.prototype.rotate=function(e){null!=e&&this.$container.css("transform","rotate("+e+")")},e}()}(this.Lyria=this.Lyria||{});