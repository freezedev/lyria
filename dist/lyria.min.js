/*! lyria - v0.2.0 - 20-04-2013 */
define("lyria/achievements",["root","jquery"],function(e,t){"use strict";var n=function(){var n,o={},r=function(t){n=t,e.localStorage&&e.localStorage[n]&&(o=JSON.parse(e.localStorage[n]))},i=function(e,t,n){o[e]={active:!1},t!==void 0&&(o[e].description=t),n!==void 0&&(o[e].icon=n)},a=function(){return Object.keys(o).length},c=function(){var e=0;for(var t in o)o[t].active&&e++;return e},s=function(){var e="";for(var t in o)e+=o[t].active?'<div class="ach_box unlocked"><span class="ach_unlocked">'+t+'</span><br /><span class="ach_details">'+o[t].description+"</span></div><br /><br />":'<div class="ach_box locked"><span class="ach_locked">'+t+'</span><br /><span class="ach_details">'+o[t].description+"</span></div><br /><br />";return e},u=function(r){"undefined"===o[r]&&i(r),o[r].active||(o[r].icon||t(".status.achievement").css("background-image","url("+o[r].icon+")"),t(".achievement .text").html(r),t(".status.achievement").css({opacity:0}).animate({opacity:1,bottom:"8px"},750).delay(2500).animate({opacity:0,bottom:"-80px"},750),o[r].active=!0),e.localStorage&&(e.localStorage[n]=JSON.stringify(o))};return{initialize:r,getCount:a,getUnlockedCount:c,list:s,register:i,show:u}}();return n}),define("lyria/resource",{path:{assets:"assets",audio:"audio",data:"data",image:"images",scene:"scenes",video:"video",prefab:"prefabs"},name:function(e,t){if(e){var n=Lyria.Resource.path.assets,o="";return o=Lyria.Resource.path[t]?Lyria.Resource.path[t]:t,o?[n,o.split(".").join("/"),e].join("/"):[n,e].join("/")}}}),define("lyria/audio",["root","jquery"],function(e,t){"use strict";var n=function(){var e=!1,n={},o=function(e,o){if(o&&"object"==typeof o){var r=document.createElement("audio");n[e]=o,t(r).attr("id",e).attr("preload","auto").append('<source src="'+o.filepath+'" />'),t("body").append(r),o.play&&this.play(e)}},r=function(e){e&&"string"==typeof fileObj&&(t("#"+e).remove(),window.log("Lyria.audio.removeAudioElement: "+e+" removed"))},i=function(o){n[o],t("#"+o).one("ended",{audioManager:this},function(e){window.chrome?t(this).load():t(this).currentTime=0;var n=t(this).attr("id"),o=e.data.audioManager.getSound(n);o.playAfter&&t("#"+o.playAfter).length>0&&e.data.audioManager.play(o.playAfter),o.loop&&e.data.audioManager.play(t(this).attr("id"))}),t("#"+o)[0].play(),e&&(t("#"+o)[0].volume=0)},a=function(e){return n[e]},c=function(e){t("#"+e).length>0?t("#"+e)[0].pause():window.log("error","Lyria.Audio.pause: cant finde element "+e+" to pause")},s=function(e){t("#"+e).length>0&&t("#"+e)[0]&&t("#"+e)[0].pause&&(t("#"+e)[0].pause(),t("#"+e)[0].currentTime=0)},u=function(e){return t("#"+e)[0].duration},l=function(e,n){return t("#"+e).length>0?"number"!=typeof n?t("#"+e)[0].volume:(t("#"+e)[0].volume=n,void 0):0},f=function(e,n){return"number"!=typeof n?t("#"+e)[0].currentTime:(t("#"+e)[0].currentTime=n,void 0)},p=function(e,t){switch(e){case"duration":case"length":return u();case"position":case"pos":if(t===void 0)return f();f(t);break;case"volume":if(t===void 0)return l();l(t)}},d=function(o){e=o;for(var r in n)n.hasOwnProperty(r)&&t("#"+r).length>0&&(t("#"+r)[0].volume=o?0:1)};return{addAudioElement:o,removeAudioElement:r,play:i,getSound:a,pause:c,stop:s,muteSounds:d,getLength:u,volume:l,pos:f,attr:p}};return n}),define("lyria/component",function(){return function(){function e(e){this.name=null!=e?e:this.constructor.name}return e.prototype.register=function(){},e.prototype.unregister=function(){},e.prototype.render=function(){},e.prototype.update=function(){},e}()}),define("lyria/debug",function(){return!0}),define("lyria/constants",{animSpeed:300}),define("lyria/language",["root"],function(){var e="en";return detectr.Browser.language()||e}),function(e){e.frameRate=60;for(var t=["ms","moz","webkit","o"],n=0;t.length>n&&!e.requestAnimationFrame;++n)e.requestAnimationFrame=e[t[n]+"RequestAnimationFrame"],e.cancelRequestAnimationFrame=e[t[n]+"CancelRequestAnimationFrame"];e.requestAnimFrame||(e.requestAnimFrame=function(t){e.setTimeout(t,~~(1e3/e.frameRate))}),e.cancelAnimationFrame||(e.cancelAnimationFrame=function(e){clearTimeout(e)})}(this),define("lyria/entity",function(){return function(){function e(e){this.name=null!=e?e:this.constructor.name,this.components={},t={}}var t;return t={},e.prototype.add=function(e){var n,o,r,i;if(!e)return this;if(o=e.name,n=this.components[o],!n){n=e,"function"==typeof n.register&&n.register();for(r in n)i=n[r],"constructor"!==r&&"function"==typeof i&&(t[r]||(t[r]=[]),t[r].push(i),this[r]||(this[r]=function(e){return function(){var n,o,r,i;for(i=t[e],o=0,r=i.length;r>o;o++)n=i[o],n.apply(this,arguments);return this}}(r)))}return this},e.prototype.remove=function(e){var t;return this.components[e]&&("function"==typeof(t=this.components[e]).unregister&&t.unregister(),delete this.components[e]),this},e.prototype.render=function(){var e,t,n;n=this.components;for(e in n)t=n[e],"function"==typeof t.render&&t.render();return this},e.prototype.update=function(e){var t,n,o;o=this.components;for(t in o)n=o[t],"function"==typeof n.update&&n.update(e);return this},e}()}),define("lyria/eventmap",function(){"use strict";var e=[].slice;return function(){function t(){o={},n={}}var n,o;return o={},n={},t.prototype.validEvents=[],t.prototype.on=function(e,t){return!t||this.validEvents.length>0&&-1===validEvents.indexOf(e)?void 0:(o[e]={event:t,id:-1,type:""},this)},t.prototype.off=function(e){return e?(("once"===o[e].type||"repeat"===o[e].type)&&("repeat"===o[e].type&&window.clearInterval(o[e].id),"once"===o[e].type&&window.clearTimeout(o[e].id)),o[e]&&delete o[e],this):void 0},t.prototype.trigger=function(){var t,n,r,i,a,c,s;return r=arguments[0],t=arguments.length>=2?e.call(arguments,1):[],null!=r?("object"==typeof r?(a=r.name,i=r.interval,c=r.repeat,n=r.context):a=r,null==i&&(i=0),null==c&&(c=!1),null==n&&(n=this),s=function(){return o[a]?o[a].event.apply(n,t):void 0},i?c?(o[a].type="repeat",o[a].id=window.setInterval(s,i)):(o[a].type="once",o[a].id=window.setTimeout(s,i)):(o[a].type="direct",s.call(this)),this):void 0},t}()}),define("lyria/events",["lyria/eventmap"],function(e){var t=t||new e;return t}),define("lyria/game",["lyria/viewport","lyria/scene/director"],function(e,t){"use strict";return function(){var n=function(){};return n.prototype.viewport=new e,n.prototype.director=new t(n.prototype.viewport),n.prototype.preloader=null,n}()}),define("lyria/gameobject",function(){"use strict";return function(){var e=function(){};return e.prototype.add=function(){},e.prototype.execute=function(){},e.prototype.log=function(){},e}()}),define("lyria/layer",["lyria/gameobject"],function(e){"use strict";return function(e){var t=function(){};return t.prototype=e.prototype,t}(e)}),define("lyria/localization",["checkt","jquery","lyria/language"],function(e,t,n){"use strict";return function(){var e=function(e,o){if(e){var r={},i={language:n};o=t.extend(!0,i,o);var a={};global.check(e,{object:function(e){a=e},string:function(e){t.ajax({url:e,async:!1,dataType:"json",success:function(e){a=e}})}}),r=a[o.language],r||(r=a.en),this.localizeLangObject=r}};return e.prototype.get=function(e,t){return this.localizeLangObject&&this.localizeLangObject[e]?this.localizeLangObject[e]:e||t?e?t?t:e:t:this.localizeLangObject},e}()}),define("lyria/globallocalization",["lyria/localization","lyria/resource"],function(e,t){var n=n||new e(t.name("i18n.json"));return n}),define("lyria/log",["root"],function(e){"use strict";var t=function(){var t={};t.Connector=null,t.Plugins={},t.Plugins.Console={e:function(t){e.console&&e.console.error&&e.console.error(t)},w:function(t){e.console&&e.console.warn&&e.console.warn(t)},i:function(t){e.console&&e.console.info&&e.console.info(t)},d:function(t){e.console&&e.console.log&&e.console.log(t)},v:function(t){e.console&&e.console.log&&e.console.log(t)}},t.Connector=t.Plugins.Console,t.logLevelMap={error:["e"],warn:["w","e"],info:["i","w","e"],debug:["d","i","w","e"],verbose:["v","d","i","w","e"]},t.logLevel="verbose";for(var n=["v","d","i","w","e"],o=0,r=n.length;r>o;o++)(function(e){t[e]=function(){t.logLevelMap[t.logLevel].indexOf(e)>=0&&t.Connector[e].apply(this,arguments)}})(n[o]);return t}();return e.log=e.out=Lyria.Log.i,t}),define("lyria/loop",["root"],function(e){"use strict";return function(){var t={},n=!0,o=function(){var o;(function r(){e.requestAnimFrame(r);var i=Date.now(),a=i-(o||i);o=i,n&&$.each(t,function(e,t){t.paused||t.value(a)})})()},r=function(){n=!1},i=function(){t={}},a=function(e,n){t[e]={paused:!1,value:n}},c=function(e){t[e].paused=!0},s=function(e){t[e].paused=!1},u=function(e){delete t[e]};return{run:o,stop:r,clear:i,addTask:a,removeTask:u,pauseTask:c,resumeTask:s}}()}),define("lyria/prefab",["lyria/scene","jquery"],function(e,t){"use strict";return function(e,n){var o={target:null,template:"prefab.html",data:"prefab.js",path:"prefab",isPrefab:!0};return n=t.extend(!0,o,n),Lyria.Scene(e,n)}}),define("lyria/preloader",["checkt","jquery"],function(e,t){"use strict";var n={maxAssets:0,assetsLoaded:0,percentLoaded:0,init:function(e,o){function r(){n.percentLoaded=n.assetsLoaded/n.maxAssets,n.onProgressChange&&n.onProgressChange(n.percentLoaded),o.showLoadingScreen,n.assetsLoaded===n.maxAssets&&(o.showLoadingScreen,n.complete&&"function"==typeof n.complete&&n.complete())}var i={showLoadingScreen:!0,loadingScreenClass:"loading-screen",loadingBarClass:"loading-bar"};o=t.extend(!0,i,o),e.length&&(n.maxAssets=e.length,t.each(e,function(e,o){global.check(o,{object:function(){},string:function(e){if(e.contains("/"+Lyria.Resource.path.image+"/")){var o=new global.Image;o.onload=function(){n.assetsLoaded++,r()},o.onerror=function(){global.Log.e("Error while loading "+e)},o.src=e}else t.ajax({url:e,dataType:"text"}).always(function(){n.assetsLoaded++,r()}).error(function(t){global.Log.e("Error while loading "+e+": "+t)})}})}))},onProgressChange:function(){},complete:function(){}};return n}),define("lyria/scene/director",["root","jquery","lyria/scene","lyria/viewport"],function(e,t,n,o){"use strict";return function(){function r(e,t){this.viewport=e instanceof o?e:new o(e,t),this.sceneList={},this.currentScene=null,this.onSceneChange=function(){}}return r.prototype.sceneClassName="scene",r.prototype.add=function(o){if(!(o instanceof n)){if(!(Lyria&&Lyria.Scenes&&Lyria.Scenes[o]))throw"No valid scene found.";o=Lyria.Scenes[o]}return o.parent=this,this.sceneList[o.name]=o,this.viewport.$container&&0===t("#"+o.name).length&&(this.viewport.$container.prepend(t(e.document.createElement("div")).attr("id",o.name).attr("class",r.prototype.sceneClassName)),o.content&&t("#"+o.name).html(o.content),o.events&&!t.isEmptyObject(o.events)&&t.each(o.events,function(e,n){"object"==typeof n&&"delegate"!==e&&t(o.events.delegate).on(n,e,{scene:o})})),this},r.prototype.show=function(e,n,o){this.onSceneChange&&this.onSceneChange(e),t("."+r.prototype.sceneClassName+":visible")&&t("."+r.prototype.sceneClassName).hide(),this.currentScene&&(this.currentScene.transition&&this.currentScene.length?t("#"+this.currentScene).hide(this.currentScene.transition.length,function(){t("."+r.prototype.sceneClassName).hide()}):t("."+r.prototype.sceneClassName).hide(),this.currentScene.onDeactivated&&this.currentScene.onDeactivated(n)),t.each(this.sceneList,function(r,i){return r===e?(e.transition&&e.transition.length?t("#"+e).show(e.transition.length):t("#"+e).show(),this.currentScene=i,this.currentScene.onActive&&this.currentScene.onActive(n),o&&o(e),!1):void 0})},r.prototype.render=function(){this.currentScene.render&&this.currentScene.render()},r.prototype.update=function(e){this.currentScene.update&&this.currentScene.update(e)},r}()}),define("lyria/scene",["jquery","lyria/eventmap","lyria/gameobject"],function(e,t,n){"use strict";return function(){var n=function(n,o,r){if(n){var i=this;this.name=n,this.eventMap=new t,this.localization={};var a={},c=o.call(a,this);e.each(a,function(e,t){i[e]||(i[e]=t)}),this.template&&(this.content=this.template(c)),this.events&&(this.events.delegate=r&&r.isPrefab?r.target?r.target:"body":"#"+n)}};n.prototype.add=function(e){};for(var o=Object.keys(t.prototype),r=0,i=o.length;i>r;r++)(function(e){n.prototype[e]=function(){this.eventMap[e].apply(this,arguments)}})(o[r]);return n}()}),define("lyria/template/connector",function(){var e=function(){},t=["compile"];return function(){for(var n=function(e){if("object"==typeof e){var t,n;for(t in e)n=e[t],"function"==typeof n&&(this[t]=n)}},o=0,r=t.length;r>o;o++)(function(t){n.prototype[t]=e})(t[o]);return n}()}),define("lyria/template/engine",["root","lyria/template/connector"],function(e){var t=function(){},n=function(e){if(e instanceof Lyria.TemplateConnector)for(var n=0,o=templateMethods.length;o>n;n++)(function(n){Lyria.TemplateEngine[n]=null!=e[n]&&"function"==typeof e[n]?e[n]:t})(templateMethods[n])};if(e.Handlebars){var o=new Lyria.TemplateConnector({compile:function(){return e.Handlebars.template.apply(this,arguments)}});return n(o)}return n}),define("lyria/utils",["jquery"],function(e){var t={};return t.isFile=function(e){var t=e.indexOf(".");if(-1===t)return!1;var n=e.length,o=n-t;return o>1&&5>=o?!0:!1},t.cloneObject=function(t){return e.extend(!0,{},t)},t.serializeObject=function(t){if(!("object"!=typeof t||t instanceof e)){var n="{";for(var o in t)if(t.hasOwnProperty(o)){if(t[o]instanceof e)continue;var r=Object.keys(t),i=r.indexOf(o)===r.length-1?"":",";switch(typeof t[o]){case"object":n+=o+": "+Lyria.Utils.serializeObject(t[o])+i+"\n";break;case"string":n+=o+': "'+t[o]+'"'+i+"\n";break;default:n+=o+": "+t[o]+i+"\n"}}return n+="}"}},t}),define("lyria/video",function(){"use strict";return function(){var e=function(){};return e.prototype.loadFromFile=function(){},e.prototype.play=function(){},e.prototype.pause=function(){},e.prototype.stop=function(){},e}()}),define("lyria/viewport",["root"],function(e){"use strict";Lyria.Viewport=function(){function t(t,n){if(null==t&&(t="viewport"),$("#"+t).length>0)this.$container=$("#"+t);else{var o=$(e.document.createElement("div")).attr("id",t);n?$(n).prepend(o):$("body").prepend(o),this.$container=$("#"+t)}}return t.prototype.scale=function(e,t){null!=e&&(null==t&&(t=e),this.$container.css("transform","scale("+e+","+t+")"))},t.prototype.center=function(){},t.prototype.rotate=function(e){null!=e&&this.$container.css("transform","rotate("+e+")")},t}()});